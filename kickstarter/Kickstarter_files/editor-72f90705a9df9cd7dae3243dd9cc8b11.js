/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
 CSS Class Applier module for Rangy.
 Adds, removes and toggles CSS classes on Ranges and Selections

 Part of Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Depends on Rangy core.

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
 Selection save and restore module for Rangy.
 Saves and restores user selections using marker invisible elements in the DOM.

 Part of Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Depends on Rangy core.

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
 Serializer module for Rangy.
 Serializes Ranges and Selections. An example use would be to store a user's selection on a particular page in a
 cookie or local storage and restore it on the user's next visit to the same page.

 Part of Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Depends on Rangy core.

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
*/
window.rangy=function(){function a(a,b){var c=typeof a[b];return c==k||!!(c==i&&a[b])||c=="unknown"}function b(a,b){return!!(typeof a[b]==i&&a[b])}function c(a,b){return typeof a[b]!=o}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&l(a,p)&&u(a,m)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a);q.initialized=!0;q.supported=!1}function g(){if(!q.initialized){var c,d=!1,i=!1;a(document,"createRange")&&
(c=document.createRange(),l(c,n)&&u(c,r)&&(d=!0),c.detach());if((c=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(c,"createTextRange"))c=c.createTextRange(),e(c)&&(i=!0);!d&&!i&&f("Neither Range nor TextRange are implemented");q.initialized=!0;q.features={implementsDomRange:d,implementsTextRange:i};d=B.concat(v);i=0;for(c=d.length;i<c;++i)try{d[i](q)}catch(g){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
g)}}}function h(a){this.name=a;this.supported=this.initialized=!1}var i="object",k="function",o="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],n=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents",
"cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],p=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],l=d(a),s=d(b),u=d(c),q={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:l,areHostObjects:s,areHostProperties:u,isTextRange:e},features:{},modules:{},
config:{alertOnWarn:!1,preferTextRange:!1}};q.fail=f;q.warn=function(a){a="Rangy warning: "+a;q.config.alertOnWarn?window.alert(a):typeof window.console!=o&&typeof window.console.log!=o&&window.console.log(a)};({}).hasOwnProperty?q.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var v=[],B=[];q.init=g;q.addInitListener=function(a){q.initialized?a(q):v.push(a)};var z=[];q.addCreateMissingNativeApiListener=function(a){z.push(a)};q.createMissingNativeApi=
function(a){a=a||window;g();for(var b=0,c=z.length;b<c;++b)z[b](a)};h.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};h.prototype.warn=function(a){q.warn("Module "+this.name+": "+a)};h.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};q.createModule=function(a,b){var c=new h(a);q.modules[a]=c;B.push(function(a){b(a,c);c.initialized=!0;c.supported=!0})};q.requireModules=function(a){for(var b=
0,c=a.length,d,e;b<c;++b){e=a[b];d=q.modules[e];if(!d||!(d instanceof h))throw Error("Module '"+e+"' not found");if(!d.supported)throw Error("Module '"+e+"' not supported");}};var x=!1;s=function(){x||(x=!0,q.initialized||g())};if(typeof window==o)f("No window found");else if(typeof document==o)f("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",s,!1),a(window,"addEventListener")?window.addEventListener("load",s,!1):a(window,"attachEvent")?
window.attachEvent("onload",s):f("Window does not have required addEventListener or attachEvent method"),q}();
rangy.createModule("DomUtil",function(a,b){function c(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(l(c,d))return d;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function f(a){a=a.nodeType;return a==3||a==4||a==8}function g(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a);return a}function h(a){if(a.nodeType==9)return a;
else if(typeof a.ownerDocument!=n)return a.ownerDocument;else if(typeof a.document!=n)return a.document;else if(a.parentNode)return h(a.parentNode);else throw Error("getDocument: no document found for node");}function i(a){if(!a)return"[No node]";return f(a)?'"'+a.data+'"':a.nodeType==1?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function k(a){this._next=this.root=a}function o(a,b){this.node=a;this.offset=b}function r(a){this.code=this[a];this.codeName=a;this.message=
"DOMException: "+this.codeName}var n="undefined",m=a.util;m.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method");m.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var p=document.createElement("div");m.areHostMethods(p,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation");m.isHostProperty(p,"innerHTML")||b.fail("Element is missing innerHTML property");
p=document.createTextNode("test");m.areHostMethods(p,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var l=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};k.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=
this._next=this.root=null}};o.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+i(this.node)+":"+this.offset+")]"}};r.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};r.prototype.toString=function(){return this.message};a.dom={arrayContains:l,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==n||(b=a.namespaceURI)===
null||b=="http://www.w3.org/1999/xhtml"},parentElement:function(a){a=a.parentNode;return a.nodeType==1?a:null},getNodeIndex:c,getNodeLength:function(a){var b;return f(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;)if(b===a)return!0;else b=b.parentNode;return!1},getClosestAncestorIn:e,isCharacterDataNode:f,insertAfter:g,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);g(c,a);return c},
getDocument:h,getWindow:function(a){a=h(a);if(typeof a.defaultView!=n)return a.defaultView;else if(typeof a.parentWindow!=n)return a.parentWindow;else throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=n)return a.contentWindow;else if(typeof a.contentDocument!=n)return a.contentDocument.defaultView;else throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=n)return a.contentDocument;
else if(typeof a.contentWindow!=n)return a.contentWindow.document;else throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return m.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,b,f,i){var g;if(a==f)return b===i?0:b<i?-1:1;else if(g=e(f,a,!0))return b<=c(g)?-1:1;else if(g=e(a,f,!0))return c(g)<i?-1:1;else if(b=d(a,f),a=a===b?b:e(a,b,!0),f=f===
b?b:e(f,b,!0),a===f)throw Error("comparePoints got to case 4 and childA and childB are the same!");else{for(b=b.firstChild;b;){if(b===a)return-1;else if(b===f)return 1;b=b.nextSibling}throw Error("Should not be here!");}},inspectNode:i,fragmentFromNodeChildren:function(a){for(var b=h(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new k(a)},DomPosition:o};a.DOMException=r});
rangy.createModule("DomRange",function(a){function b(a,b){return a.nodeType!=3&&(j.isAncestorOf(a,b.startContainer,!0)||j.isAncestorOf(a,b.endContainer,!0))}function c(a){return j.getDocument(a.startContainer)}function d(a,b,c){if(b=a._listeners[b])for(var d=0,e=b.length;d<e;++d)b[d].call(a,{target:a,args:c})}function e(a){return new G(a.parentNode,j.getNodeIndex(a))}function f(a){return new G(a.parentNode,j.getNodeIndex(a)+1)}function g(a,b,c){var d=a.nodeType==11?a.firstChild:a;j.isCharacterDataNode(b)?
c==b.length?j.insertAfter(a,b):b.parentNode.insertBefore(a,c==0?b:j.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return d}function h(a){for(var b,d,e=c(a.range).createDocumentFragment();d=a.next();){b=a.isPartiallySelectedSubtree();d=d.cloneNode(!b);b&&(b=a.getSubtreeIterator(),d.appendChild(h(b)),b.detach(!0));if(d.nodeType==10)throw new A("HIERARCHY_REQUEST_ERR");e.appendChild(d)}return e}function i(a,b,c){var d,e;for(c=c||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree())if(b(d)===
!1){c.stop=!0;break}else{if(d=a.getSubtreeIterator(),i(d,b,c),d.detach(!0),c.stop)break}else for(d=j.createIterator(d);e=d.next();)if(b(e)===!1){c.stop=!0;return}}function k(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),k(b),b.detach(!0)):a.remove()}function o(a){for(var b,d=c(a.range).createDocumentFragment(),e;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),e=a.getSubtreeIterator(),b.appendChild(o(e)),e.detach(!0)):a.remove();if(b.nodeType==10)throw new A("HIERARCHY_REQUEST_ERR");
d.appendChild(b)}return d}function r(a,b,c){var d=!(!b||!b.length),e,f=!!c;d&&(e=RegExp("^("+b.join("|")+")$"));var g=[];i(new m(a,!1),function(a){(!d||e.test(a.nodeType))&&(!f||c(a))&&g.push(a)});return g}function n(a){return"["+(typeof a.getName=="undefined"?"Range":a.getName())+"("+j.inspectNode(a.startContainer)+":"+a.startOffset+", "+j.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function m(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&j.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!j.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:j.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!j.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:j.getClosestAncestorIn(this.ec,c,!0))}}function p(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function l(a,b,c){this.nodes=r(a,b,c);this._next=this.nodes[0];this._position=0}function s(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){d=e.nodeType;if(j.arrayContains(a,d))return e;e=e.parentNode}return null}}function u(a,b){if(ba(a,b))throw new p("INVALID_NODE_TYPE_ERR");}function q(a){if(!a.startContainer)throw new A("INVALID_STATE_ERR");}function v(a,b){if(!j.arrayContains(b,a.nodeType))throw new p("INVALID_NODE_TYPE_ERR");
}function B(a,b){if(b<0||b>(j.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new A("INDEX_SIZE_ERR");}function z(a,b){if(P(a,!0)!==P(b,!0))throw new A("WRONG_DOCUMENT_ERR");}function x(a){if(ca(a,!0))throw new A("NO_MODIFICATION_ALLOWED_ERR");}function w(a,b){if(!a)throw new A(b);}function D(a){return!!a.startContainer&&!!a.endContainer&&!(!j.arrayContains(J,a.startContainer.nodeType)&&!P(a.startContainer,!0))&&!(!j.arrayContains(J,a.endContainer.nodeType)&&!P(a.endContainer,!0))&&a.startOffset<=
(j.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length)&&a.endOffset<=(j.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)}function t(a){q(a);if(!D(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function F(){}function E(a){a.START_TO_START=R;a.START_TO_END=V;a.END_TO_END=da;a.END_TO_START=W;a.NODE_BEFORE=X;a.NODE_AFTER=Y;a.NODE_BEFORE_AND_AFTER=Z;a.NODE_INSIDE=S}function C(a){E(a);
E(a.prototype)}function K(a,b){return function(){t(this);var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,g=new m(this,!0);if(c!==e)c=j.getClosestAncestorIn(c,e,!0),d=f(c),c=d.node,d=d.offset;i(g,x);g.reset();e=a(g);g.detach();b(this,c,d,c,d);return e}}function M(c,d,i){function g(a,b){return function(c){q(this);v(c,H);v(N(c),J);c=(a?e:f)(c);(b?Q:l)(this,c.node,c.offset)}}function Q(a,b,c){var e=a.endContainer,f=a.endOffset;if(b!==a.startContainer||c!==a.startOffset){if(N(b)!=
N(e)||j.comparePoints(b,c,e,f)==1)e=b,f=c;d(a,b,c,e,f)}}function l(a,b,c){var e=a.startContainer,f=a.startOffset;if(b!==a.endContainer||c!==a.endOffset){if(N(b)!=N(e)||j.comparePoints(b,c,e,f)==-1)e=b,f=c;d(a,e,f,b,c)}}c.prototype=new F;a.util.extend(c.prototype,{setStart:function(a,b){q(this);u(a,!0);B(a,b);Q(this,a,b)},setEnd:function(a,b){q(this);u(a,!0);B(a,b);l(this,a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){t(this);a?
d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){q(this);u(a,!0);d(this,a,0,a,j.getNodeLength(a))},selectNode:function(a){q(this);u(a,!1);v(a,H);var b=e(a);a=f(a);d(this,b.node,b.offset,a.node,a.offset)},extractContents:K(o,d),deleteContents:K(k,d),canSurroundContents:function(){t(this);x(this.startContainer);x(this.endContainer);var a=new m(this,!0),c=a._first&&
b(a._first,this)||a._last&&b(a._last,this);a.detach();return!c},detach:function(){i(this)},splitBoundaries:function(){t(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=a===c;j.isCharacterDataNode(c)&&e>0&&e<c.length&&j.splitDataNode(c,e);j.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=j.splitDataNode(a,b),f?(e-=b,c=a):c==a.parentNode&&e>=j.getNodeIndex(a)&&e++,b=0);d(this,a,b,c,e)},normalizeBoundaries:function(){t(this);var a=this.startContainer,b=this.startOffset,
c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;if(b&&b.nodeType==a.nodeType)c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b)},i=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var g=d.length;b=f.length;d.insertData(0,f.data);f.parentNode.removeChild(f);a==c?(e+=b,c=a):c==d.parentNode&&(f=j.getNodeIndex(d),e==f?(c=d,e=g):e>f&&e--)}},g=!0;j.isCharacterDataNode(c)?c.length==e&&f(c):(e>0&&(g=c.childNodes[e-1])&&j.isCharacterDataNode(g)&&f(g),
g=!this.collapsed);g?j.isCharacterDataNode(a)?b==0&&i(a):b<a.childNodes.length&&(f=a.childNodes[b])&&j.isCharacterDataNode(f)&&i(f):(a=c,b=e);d(this,a,b,c,e)},collapseToPoint:function(a,b){q(this);u(a,!0);B(a,b);(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&d(this,a,b,a,b)}});C(c)}function L(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:j.getCommonAncestor(a.startContainer,
a.endContainer)}function O(a,b,c,e,f){var g=a.startContainer!==b||a.startOffset!==c,i=a.endContainer!==e||a.endOffset!==f;a.startContainer=b;a.startOffset=c;a.endContainer=e;a.endOffset=f;L(a);d(a,"boundarychange",{startMoved:g,endMoved:i})}function y(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};L(this)}a.requireModules(["DomUtil"]);var j=a.dom,G=j.DomPosition,A=a.DOMException;m.prototype={_current:null,_next:null,_first:null,
_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;if(a)this._next=a!==this._last?a.nextSibling:null,j.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so));return a},remove:function(){var a=this._current,b,c;j.isCharacterDataNode(a)&&
(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return b(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new y(c(this.range));var b=this._current,d=b,e=0,f=b,g=j.getNodeLength(b);if(j.isAncestorOf(b,this.sc,!0))d=this.sc,e=this.so;if(j.isAncestorOf(b,this.ec,!0))f=
this.ec,g=this.eo;O(a,d,e,f,g)}return new m(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};p.prototype.toString=function(){return this.message};l.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},
detach:function(){this._current=this._next=this.nodes=null}};var H=[1,3,4,5,7,8,10],J=[2,9,11],I=[1,3,4,5,7,8,10,11],Q=[1,3,4,5,7,8],N=j.getRootContainer,P=s([9,11]),ca=s([5,6,10,12]),ba=s([6,10,12]),aa=document.createElement("style"),T=!1;try{aa.innerHTML="<b>x</b>",T=aa.firstChild.nodeType==3}catch(ea){}a.features.htmlParsingConforms=T;var U=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],R=0,V=1,da=2,W=3,X=0,Y=1,Z=2,S=3;F.prototype={attachListener:function(a,
b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){t(this);z(this.startContainer,b.startContainer);var c=a==W||a==R?"start":"end",d=a==V||a==R?"start":"end";return j.comparePoints(this[c+"Container"],this[c+"Offset"],b[d+"Container"],b[d+"Offset"])},insertNode:function(a){t(this);v(a,I);x(this.startContainer);if(j.isAncestorOf(a,this.startContainer,!0))throw new A("HIERARCHY_REQUEST_ERR");this.setStartBefore(g(a,this.startContainer,this.startOffset))},cloneContents:function(){t(this);
var a,b;if(this.collapsed)return c(this).createDocumentFragment();else{if(this.startContainer===this.endContainer&&j.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;else b=new m(this,!0),a=h(b),b.detach();return a}},canSurroundContents:function(){t(this);x(this.startContainer);x(this.endContainer);var a=new m(this,!0),c=a._first&&b(a._first,this)||a._last&&
b(a._last,this);a.detach();return!c},surroundContents:function(a){v(a,Q);if(!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){t(this);for(var a=new y(c(this)),b=U.length,d;b--;)d=U[b],a[d]=this[d];return a},toString:function(){t(this);var a=this.startContainer;if(a===this.endContainer&&j.isCharacterDataNode(a))return a.nodeType==
3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";else{var b=[];a=new m(this,!0);i(a,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)});a.detach();return b.join("")}},compareNode:function(a){t(this);var b=a.parentNode,c=j.getNodeIndex(a);if(!b)throw new A("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return a<0?b>0?Z:X:b>0?Y:S},comparePoint:function(a,b){t(this);w(a,"HIERARCHY_REQUEST_ERR");z(a,this.startContainer);if(j.comparePoints(a,b,this.startContainer,
this.startOffset)<0)return-1;else if(j.comparePoints(a,b,this.endContainer,this.endOffset)>0)return 1;return 0},createContextualFragment:T?function(a){var b=this.startContainer,c=j.getDocument(b);if(!b)throw new A("INVALID_STATE_ERR");var d=null;b.nodeType==1?d=b:j.isCharacterDataNode(b)&&(d=j.parentElement(b));d=d===null||d.nodeName=="HTML"&&j.isHtmlNamespace(j.getDocument(d).documentElement)&&j.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1);d.innerHTML=a;return j.fragmentFromNodeChildren(d)}:
function(a){q(this);var b=c(this).createElement("body");b.innerHTML=a;return j.fragmentFromNodeChildren(b)},toHtml:function(){t(this);var a=c(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,b){t(this);w(a,"NOT_FOUND_ERR");if(j.getDocument(a)!==c(this))return!1;var d=a.parentNode,e=j.getNodeIndex(a);w(d,"NOT_FOUND_ERR");var f=j.comparePoints(d,e,this.endContainer,this.endOffset);d=j.comparePoints(d,e+1,this.startContainer,this.startOffset);
return b?f<=0&&d>=0:f<0&&d>0},isPointInRange:function(a,b){t(this);w(a,"HIERARCHY_REQUEST_ERR");z(a,this.startContainer);return j.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&j.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){t(this);if(c(a)!=c(this))throw new A("WRONG_DOCUMENT_ERR");var d=j.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=j.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);
return b?d<=0&&e>=0:d<0&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=j.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=j.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();b==-1&&d.setStart(a.startContainer,a.startOffset);c==1&&d.setEnd(a.endContainer,a.endOffset);return d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();j.comparePoints(a.startContainer,a.startOffset,
this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset);j.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)==1&&b.setEnd(a.endContainer,a.endOffset);return b}else throw new p("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==S},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,j.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},
containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return c.length>0?(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){t(this);return new l(this,a,b)},getNodes:function(a,b){t(this);return r(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){q(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){q(this);this.setStartAfter(a);
this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return y.rangesEqual(this,a)},isValid:function(){return D(this)},inspect:function(){return n(this)}};M(y,O,function(a){q(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;d(a,"detach",null);a._listeners=null});a.rangePrototype=F.prototype;y.rangeProperties=U;y.RangeIterator=m;y.copyComparisonConstants=C;y.createPrototypeRange=M;y.inspect=n;y.getRangeDocument=c;y.rangesEqual=
function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset};a.DomRange=y;a.RangeException=p});
rangy.createModule("WrappedRange",function(a){function b(a,b,c,d){var g=a.duplicate();g.collapse(c);var h=g.parentElement();e.isAncestorOf(b,h,!0)||(h=b);if(!h.canHaveHTML)return new f(h.parentNode,e.getNodeIndex(h));b=e.getDocument(h).createElement("span");var p,l=c?"StartToStart":"StartToEnd";do h.insertBefore(b,b.previousSibling),g.moveToElementText(b);while((p=g.compareEndPoints(l,a))>0&&b.previousSibling);l=b.nextSibling;if(p==-1&&l&&e.isCharacterDataNode(l)){g.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(l.data)){h=g.duplicate();c=h.text.replace(/\r\n/g,"\r").length;for(c=h.moveStart("character",c);h.compareEndPoints("StartToEnd",h)==-1;)c++,h.moveStart("character",1)}else c=g.text.length;h=new f(l,c)}else l=(d||!c)&&b.previousSibling,h=(c=(d||c)&&b.nextSibling)&&e.isCharacterDataNode(c)?new f(c,0):l&&e.isCharacterDataNode(l)?new f(l,l.length):new f(h,e.getNodeIndex(b));b.parentNode.removeChild(b);return h}function c(a,b){var c,d,f=a.offset,g=e.getDocument(a.node),h=g.body.createTextRange(),
l=e.isCharacterDataNode(a.node);l?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=f<c.length?c[f]:null,d=a.node);g=g.createElement("span");g.innerHTML="&#feff;";c?d.insertBefore(g,c):d.appendChild(g);h.moveToElementText(g);h.collapse(!b);d.removeChild(g);if(l)h[b?"moveStart":"moveEnd"]("character",f);return h}a.requireModules(["DomUtil","DomRange"]);var d,e=a.dom,f=e.DomPosition,g=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange))(function(){function b(a){for(var c=
f.length,d;c--;)d=f[c],a[d]=a.nativeRange[d]}var c,f=g.rangeProperties,h;d=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;b(this)};g.createPrototypeRange(d,function(a,b,c,d,e){var f=a.endContainer!==d||a.endOffset!=e;if(a.startContainer!==b||a.startOffset!=c||f)a.setEnd(d,e),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=f.length,c;b--;)c=f[b],a[c]=null});c=d.prototype;c.selectNode=function(a){this.nativeRange.selectNode(a);b(this)};c.deleteContents=
function(){this.nativeRange.deleteContents();b(this)};c.extractContents=function(){var a=this.nativeRange.extractContents();b(this);return a};c.cloneContents=function(){return this.nativeRange.cloneContents()};c.surroundContents=function(a){this.nativeRange.surroundContents(a);b(this)};c.collapse=function(a){this.nativeRange.collapse(a);b(this)};c.cloneRange=function(){return new d(this.nativeRange.cloneRange())};c.refresh=function(){b(this)};c.toString=function(){return this.nativeRange.toString()};
var n=document.createTextNode("test");e.getBody(document).appendChild(n);var m=document.createRange();m.setStart(n,0);m.setEnd(n,0);try{m.setStart(n,1),c.setStart=function(a,c){this.nativeRange.setStart(a,c);b(this)},c.setEnd=function(a,c){this.nativeRange.setEnd(a,c);b(this)},h=function(a){return function(c){this.nativeRange[a](c);b(this)}}}catch(p){c.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(d){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}b(this)},c.setEnd=function(a,
c){try{this.nativeRange.setEnd(a,c)}catch(d){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}b(this)},h=function(a,c){return function(d){try{this.nativeRange[a](d)}catch(e){this.nativeRange[c](d),this.nativeRange[a](d)}b(this)}}}c.setStartBefore=h("setStartBefore","setEndBefore");c.setStartAfter=h("setStartAfter","setEndAfter");c.setEndBefore=h("setEndBefore","setStartBefore");c.setEndAfter=h("setEndAfter","setStartAfter");m.selectNodeContents(n);c.selectNodeContents=m.startContainer==
n&&m.endContainer==n&&m.startOffset==0&&m.endOffset==n.length?function(a){this.nativeRange.selectNodeContents(a);b(this)}:function(a){this.setStart(a,0);this.setEnd(a,g.getEndOffset(a))};m.selectNodeContents(n);m.setEnd(n,3);h=document.createRange();h.selectNodeContents(n);h.setEnd(n,4);h.setStart(n,2);c.compareBoundaryPoints=m.compareBoundaryPoints(m.START_TO_END,h)==-1&m.compareBoundaryPoints(m.END_TO_START,h)==1?function(a,b){b=b.nativeRange||b;if(a==b.START_TO_END)a=b.END_TO_START;else if(a==
b.END_TO_START)a=b.START_TO_END;return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};if(a.util.isHostMethod(m,"createContextualFragment"))c.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)};e.getBody(document).removeChild(n);m.detach();h.detach()})(),a.createNativeRange=function(a){return(a||document).createRange()};else if(a.features.implementsTextRange){d=function(a){this.textRange=
a;this.refresh()};d.prototype=new g(document);d.prototype.refresh=function(){var a,c,d=this.textRange;a=d.parentElement();var f=d.duplicate();f.collapse(!0);c=f.parentElement();f=d.duplicate();f.collapse(!1);d=f.parentElement();c=c==d?c:e.getCommonAncestor(c,d);c=c==a?c:e.getCommonAncestor(a,c);this.textRange.compareEndPoints("StartToEnd",this.textRange)==0?c=a=b(this.textRange,c,!0,!0):(a=b(this.textRange,c,!0,!1),c=b(this.textRange,c,!1,!1));this.setStart(a.node,a.offset);this.setEnd(c.node,c.offset)};
g.copyComparisonConstants(d);var h=function(){return this}();if(typeof h.Range=="undefined")h.Range=d;a.createNativeRange=function(a){return(a||document).body.createTextRange()}}if(a.features.implementsTextRange)d.rangeToTextRange=function(a){if(a.collapsed)return c(new f(a.startContainer,a.startOffset),!0);else{var b=c(new f(a.startContainer,a.startOffset),!0),d=c(new f(a.endContainer,a.endOffset),!1);a=e.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",b);a.setEndPoint("EndToEnd",
d);return a}};d.prototype.getName=function(){return"WrappedRange"};a.WrappedRange=d;a.createRange=function(b){return new d(a.createNativeRange(b||document))};a.createRangyRange=function(a){return new g(a||document)};a.createIframeRange=function(b){return a.createRange(e.getIframeDocument(b))};a.createIframeRangyRange=function(b){return a.createRangyRange(e.getIframeDocument(b))};a.addCreateMissingNativeApiListener(function(b){b=b.document;if(typeof b.createRange=="undefined")b.createRange=function(){return a.createRange(this)};
b=b=null})});
rangy.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start";c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function f(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function g(b){var c;if(b instanceof u){if(c=b._selectionNativeRange,
!c)c=a.createNativeRange(l.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null})}else b instanceof q?c=b.nativeRange:a.features.implementsDomRange&&b instanceof l.getWindow(b.startContainer).Range&&(c=b);return c}function h(a){var b=a.getNodes(),c;a:if(!b.length||b[0].nodeType!=1)c=!1;else{c=1;for(var d=b.length;c<d;++c)if(!l.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function i(a,b){var c=new q(b);a._ranges=[c];e(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function k(b){b._ranges.length=0;if(b.docSelection.type=="None")f(b);else{var c=b.docSelection.createRange();if(c&&typeof c.text!="undefined")i(b,c);else{b.rangeCount=c.length;for(var d,g=l.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(g),d.selectNode(c.item(h)),
b._ranges.push(d);b.isCollapsed=b.rangeCount==1&&b._ranges[0].collapsed;e(b,b._ranges[b.rangeCount-1],!1)}}}function o(a,b){var c=a.docSelection.createRange(),d=h(b),e=l.getDocument(c.item(0));e=l.getBody(e).createControlRange();for(var f=0,g=c.length;f<g;++f)e.add(c.item(f));try{e.add(d)}catch(i){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}e.select();k(a)}function r(a,b,c){this.nativeSelection=a;this.docSelection=b;
this._ranges=[];this.win=c;this.refresh()}function n(a,b){var c=l.getDocument(b[0].startContainer);c=l.getBody(c).createControlRange();for(var d=0,e;d<rangeCount;++d){e=h(b[d]);try{c.add(e)}catch(f){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();k(a)}function m(a,b){if(a.anchorNode&&l.getDocument(a.anchorNode)!==l.getDocument(b))throw new v("WRONG_DOCUMENT_ERR");}function p(a){var b=[],c=new B(a.anchorNode,
a.anchorOffset),d=new B(a.focusNode,a.focusOffset),e=typeof a.getName=="function"?a.getName():"Selection";if(typeof a.rangeCount!="undefined")for(var f=0,g=a.rangeCount;f<g;++f)b[f]=u.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var l=a.dom,s=a.util,u=a.DomRange,q=a.WrappedRange,v=a.DOMException,B=l.DomPosition,z,x,w=a.util.isHostMethod(window,
"getSelection"),D=a.util.isHostObject(document,"selection"),t=D&&(!w||a.config.preferTextRange);t?(z=d,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return b.type!="None"||l.getDocument(b.createRange().parentElement())==a}):w?(z=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=z;w=z();var F=a.createNativeRange(document),E=l.getBody(document),C=s.areHostObjects(w,s.areHostProperties(w,["anchorOffset",
"focusOffset"]));a.features.selectionHasAnchorAndFocus=C;var K=s.isHostMethod(w,"extend");a.features.selectionHasExtend=K;var M=typeof w.rangeCount=="number";a.features.selectionHasRangeCount=M;var L=!1,O=!0;s.areHostMethods(w,["addRange","getRangeAt","removeAllRanges"])&&typeof w.rangeCount=="number"&&a.features.implementsDomRange&&function(){var a=document.createElement("iframe");a.frameBorder=0;a.style.position="absolute";a.style.left="-10000px";E.appendChild(a);var b=l.getIframeDocument(a);b.open();
b.write("<html><head></head><body>12</body></html>");b.close();var c=l.getIframeWindow(a).getSelection(),d=b.documentElement.lastChild.firstChild;b=b.createRange();b.setStart(d,1);b.collapse(!0);c.addRange(b);O=c.rangeCount==1;c.removeAllRanges();var e=b.cloneRange();b.setStart(d,0);e.setEnd(d,2);c.addRange(b);c.addRange(e);L=c.rangeCount==2;b.detach();e.detach();E.removeChild(a)}();a.features.selectionSupportsMultipleRanges=L;a.features.collapsedNonEditableSelectionsSupported=O;var y=!1,j;E&&s.isHostMethod(E,
"createControlRange")&&(j=E.createControlRange(),s.areHostProperties(j,["item","add"])&&(y=!0));a.features.implementsControlRange=y;x=C?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var G;s.isHostMethod(w,"getRangeAt")?G=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:C&&(G=function(b){var c=l.getDocument(b.anchorNode);c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);
c.setEnd(b.focusNode,b.focusOffset);c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),c.setEnd(b.anchorNode,b.anchorOffset));return c});a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=z(a),e=D?d(a):null;b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new r(c,e,a),a._rangySelection=b);return b};a.getIframeSelection=function(b){return a.getSelection(l.getIframeWindow(b))};j=r.prototype;if(!t&&C&&s.areHostMethods(w,["removeAllRanges","addRange"])){j.removeAllRanges=
function(){this.nativeSelection.removeAllRanges();f(this)};var A=function(b,c){var d=u.getRangeDocument(c);d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(g(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};j.addRange=M?function(b,c){if(y&&D&&this.docSelection.type=="Control")o(this,b);else if(c&&K)A(this,b);else{var d;L?d=this.rangeCount:(this.removeAllRanges(),d=0);this.nativeSelection.addRange(g(b));this.rangeCount=this.nativeSelection.rangeCount;
this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=G(this.nativeSelection,this.rangeCount-1))&&!u.rangesEqual(d,b)&&(b=new q(d)),this._ranges[this.rangeCount-1]=b,e(this,b,I(this.nativeSelection)),this.isCollapsed=x(this)):this.refresh()}}:function(a,b){b&&K?A(this,a):(this.nativeSelection.addRange(g(a)),this.refresh())};j.setRanges=function(a){if(y&&a.length>1)n(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(s.isHostMethod(w,"empty")&&s.isHostMethod(F,
"select")&&y&&t)j.removeAllRanges=function(){try{if(this.docSelection.empty(),this.docSelection.type!="None"){var a;if(this.anchorNode)a=l.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();b.length&&(a=l.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}f(this)},j.addRange=function(a){this.docSelection.type=="Control"?o(this,a):(q.rangeToTextRange(a).select(),this._ranges[0]=
a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},j.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?n(this,a):b&&this.addRange(a[0])};else return b.fail("No means of selecting a Range or TextRange was found"),!1;j.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new v("INDEX_SIZE_ERR");else return this._ranges[a]};var H;if(t)H=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=l.getBody(b.win.document).createTextRange(),
c.collapse(!0));b.docSelection.type=="Control"?k(b):c&&typeof c.text!="undefined"?i(b,c):f(b)};else if(s.isHostMethod(w,"getRangeAt")&&typeof w.rangeCount=="number")H=function(b){if(y&&D&&b.docSelection.type=="Control")k(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],I(b.nativeSelection));b.isCollapsed=x(b)}else f(b)};else if(C&&typeof w.isCollapsed==
"boolean"&&typeof F.collapsed=="boolean"&&a.features.implementsDomRange)H=function(a){var b;b=a.nativeSelection;b.anchorNode?(b=G(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=x(a)):f(a)};else return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;j.refresh=function(a){var b=a?this._ranges.slice(0):null;H(this);if(a){a=b.length;
if(a!=this._ranges.length)return!1;for(;a--;)if(!u.rangesEqual(b[a],this._ranges[a]))return!1;return!0}};var J=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,g=c.length;e<g;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||f(a)};j.removeRange=y?function(a){if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();a=h(a);var c=l.getDocument(b.item(0));c=l.getBody(c).createControlRange();for(var d,e=!1,f=0,g=b.length;f<g;++f)d=b.item(f),d!==a||e?c.add(b.item(f)):
e=!0;c.select();k(this)}else J(this,a)}:function(a){J(this,a)};var I;!t&&C&&a.features.implementsDomRange?(I=function(a){var b=!1;a.anchorNode&&(b=l.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return b},j.isBackwards=function(){return I(this)}):I=j.isBackwards=function(){return!1};j.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};j.collapse=function(b,c){m(this,b);var d=a.createRange(l.getDocument(b));d.collapseToPoint(b,
c);this.removeAllRanges();this.addRange(d);this.isCollapsed=!0};j.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new v("INVALID_STATE_ERR");};j.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new v("INVALID_STATE_ERR");};j.selectAllChildren=function(b){m(this,b);var c=a.createRange(l.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();
this.addRange(c)};j.deleteFromDocument=function(){if(y&&D&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};j.getAllRanges=function(){return this._ranges.slice(0)};j.setSingleRange=function(a){this.setRanges([a])};j.containsNode=function(a,b){for(var c=
0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};j.toHtml=function(){var a="";if(this.rangeCount){a=u.getRangeDocument(this._ranges[0]).createElement("div");for(var b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};j.getName=function(){return"WrappedSelection"};j.inspect=function(){return p(this)};j.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};r.inspect=p;a.Selection=
r;a.selectionPrototype=j;a.addCreateMissingNativeApiListener(function(b){if(typeof b.getSelection=="undefined")b.getSelection=function(){return a.getSelection(this)};b=null})});
rangy.createModule("CssClassApplier",function(a,b){function c(a,b){return a.className&&RegExp("(?:^|\\s)"+b+"(?:\\s|$)").test(a.className)}function d(a,b){a.className?c(a,b)||(a.className+=" "+b):a.className=b}function e(a){return a.split(/\s+/).sort().join(" ")}function f(a,b){return e(a.className)==e(b.className)}function g(a){for(var b=a.parentNode;a.hasChildNodes();)b.insertBefore(a.firstChild,a);b.removeChild(a)}function h(a,b){var c=a.cloneRange();c.selectNodeContents(b);var d=c.intersection(a);
d=d?d.toString():"";c.detach();return d!=""}function i(a){return a.getNodes([3],function(b){return h(a,b)})}function k(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c=0,d=a.attributes.length,e,f;c<d;++c)if(e=a.attributes[c],f=e.name,f!="class"){f=b.attributes.getNamedItem(f);if(e.specified!=f.specified)return!1;if(e.specified&&e.nodeValue!==f.nodeValue)return!1}return!0}function o(a,b){for(var c=0,d=a.attributes.length,e;c<d;++c)if(e=a.attributes[c].name,(!b||!v.arrayContains(b,
e))&&a.attributes[c].specified&&e!="class")return!0;return!1}function r(a){var b;return a&&a.nodeType==1&&((b=a.parentNode)&&b.nodeType==9&&b.designMode=="on"||x(a)&&!x(a.parentNode))}function n(a){return(x(a)||a.nodeType!=1&&x(a.parentNode))&&!r(a)}function m(a){return a&&a.nodeType==1&&!w.test(z(a,"display"))}function p(a){if(a.data.length==0)return!0;if(D.test(a.data))return!1;switch(z(a.parentNode,"whiteSpace")){case "pre":case "pre-wrap":case "-moz-pre-wrap":return!1;case "pre-line":if(/[\r\n]/.test(a.data))return!1}return m(a.previousSibling)||
m(a.nextSibling)}function l(a,c,d,e){var f,g=d==0;if(v.isAncestorOf(c,a))return a;if(v.isCharacterDataNode(c))if(d==0)d=v.getNodeIndex(c),c=c.parentNode;else if(d==c.length)d=v.getNodeIndex(c)+1,c=c.parentNode;else throw b.createError("splitNodeAt should not be called with offset in the middle of a data node ("+d+" in "+c.data);var h;h=c;var i=d;h=v.isCharacterDataNode(h)?i==0?!!h.previousSibling:i==h.length?!!h.nextSibling:!0:i>0&&i<h.childNodes.length;if(h){if(!f){f=c.cloneNode(!1);for(f.id&&f.removeAttribute("id");g=
c.childNodes[d];)f.appendChild(g);v.insertAfter(f,c)}return c==a?f:l(a,f.parentNode,v.getNodeIndex(f),e)}else if(a!=c)return f=c.parentNode,c=v.getNodeIndex(c),g||c++,l(a,f,c,e);return a}function s(a){var b=a?"nextSibling":"previousSibling";return function(c,d){var e=c.parentNode,g=c[b];if(g){if(g&&g.nodeType==3)return g}else if(d&&(g=e[b])&&g.nodeType==1&&e.tagName==g.tagName&&f(e,g)&&k(e,g))return g[a?"firstChild":"lastChild"];return null}}function u(a){this.firstTextNode=(this.isElementMerge=a.nodeType==
1)?a.lastChild:a;this.textNodes=[this.firstTextNode]}function q(a,b,c){this.cssClass=a;var d,f,g=null;if(typeof b=="object"&&b!==null){c=b.tagNames;g=b.elementProperties;for(d=0;f=E[d++];)b.hasOwnProperty(f)&&(this[f]=b[f]);d=b.normalize}else d=b;this.normalize=typeof d=="undefined"?!0:d;this.attrExceptions=[];d=document.createElement(this.elementTagName);this.elementProperties={};for(var h in g)g.hasOwnProperty(h)&&(C.hasOwnProperty(h)&&(h=C[h]),d[h]=g[h],this.elementProperties[h]=d[h],this.attrExceptions.push(h));
this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?e(this.elementProperties.className+" "+a):a;this.applyToAnyTagName=!1;a=typeof c;if(a=="string")c=="*"?this.applyToAnyTagName=!0:this.tagNames=c.toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,"").split(/\s*,\s*/);else if(a=="object"&&typeof c.length=="number"){this.tagNames=[];d=0;for(a=c.length;d<a;++d)c[d]=="*"?this.applyToAnyTagName=!0:this.tagNames.push(c[d].toLowerCase())}else this.tagNames=[this.elementTagName]}
a.requireModules(["WrappedSelection","WrappedRange"]);var v=a.dom,B=function(){function a(b,c,d){return c&&d?" ":""}return function(b,c){if(b.className)b.className=b.className.replace(RegExp("(?:^|\\s)"+c+"(?:\\s|$)"),a)}}(),z;typeof window.getComputedStyle!="undefined"?z=function(a,b){return v.getWindow(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!="undefined"?z=function(a,b){return a.currentStyle[b]}:b.fail("No means of obtaining computed style properties found");
var x;(function(){x=typeof document.createElement("div").isContentEditable=="boolean"?function(a){return a&&a.nodeType==1&&a.isContentEditable}:function(a){if(!a||a.nodeType!=1||a.contentEditable=="false")return!1;return a.contentEditable=="true"||x(a.parentNode)}})();var w=/^inline(-block|-table)?$/i,D=/[^\r\n\t\f \u200B]/,t=s(!1),F=s(!0);u.prototype={doMerge:function(){for(var a=[],b,c,d=0,e=this.textNodes.length;d<e;++d)b=this.textNodes[d],c=b.parentNode,a[d]=b.data,d&&(c.removeChild(b),c.hasChildNodes()||
c.parentNode.removeChild(c));return this.firstTextNode.data=a=a.join("")},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}};var E=["elementTagName","ignoreWhiteSpace","applyToEditableOnly"],C={"class":"className"};q.prototype={elementTagName:"span",elementProperties:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,
hasClass:function(a){return a.nodeType==1&&v.arrayContains(this.tagNames,a.tagName.toLowerCase())&&c(a,this.cssClass)},getSelfOrAncestorWithClass:function(a){for(;a;){if(this.hasClass(a,this.cssClass))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||n(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&a.nodeType==3&&p(a)},postApply:function(a,b,c){for(var d=a[0],e=a[a.length-1],f=[],g,h=d,i=e,l=0,m=e.length,o,p,k=0,n=a.length;k<
n;++k)if(o=a[k],p=t(o,!c)){g||(g=new u(p),f.push(g));g.textNodes.push(o);if(o===d)h=g.firstTextNode,l=h.length;if(o===e)i=g.firstTextNode,m=g.getLength()}else g=null;if(a=F(e,!c))g||(g=new u(e),f.push(g)),g.textNodes.push(a);if(f.length){k=0;for(n=f.length;k<n;++k)f[k].doMerge();b.setStart(h,l);b.setEnd(i,m)}},createContainer:function(b){b=b.createElement(this.elementTagName);a.util.extend(b,this.elementProperties);d(b,this.cssClass);return b},applyToTextNode:function(a){var b=a.parentNode;b.childNodes.length==
1&&v.arrayContains(this.tagNames,b.tagName.toLowerCase())?d(b,this.cssClass):(b=this.createContainer(v.getDocument(a)),a.parentNode.insertBefore(b,a),b.appendChild(a))},isRemovable:function(a){var b;if(b=a.tagName.toLowerCase()==this.elementTagName)if(b=e(a.className)==this.elementSortedClassName){var c;a:{b=this.elementProperties;for(c in b)if(b.hasOwnProperty(c)&&a[c]!==b[c]){c=!1;break a}c=!0}b=c&&!o(a,this.attrExceptions)&&this.isModifiable(a)}return b},undoToTextNode:function(a,b,c){b.containsNode(c)||
(a=b.cloneRange(),a.selectNode(c),a.isPointInRange(b.endContainer,b.endOffset)&&(l(c,b.endContainer,b.endOffset,[b]),b.setEndAfter(c)),a.isPointInRange(b.startContainer,b.startOffset)&&(c=l(c,b.startContainer,b.startOffset,[b])));this.isRemovable(c)?g(c):B(c,this.cssClass)},applyToRange:function(a){a.splitBoundaries();var b=i(a);if(b.length){for(var c,d=0,e=b.length;d<e;++d)c=b[d],!this.isIgnorableWhiteSpaceNode(c)&&!this.getSelfOrAncestorWithClass(c)&&this.isModifiable(c)&&this.applyToTextNode(c);
a.setStart(b[0],0);c=b[b.length-1];a.setEnd(c,c.length);this.normalize&&this.postApply(b,a,!1)}},applyToSelection:function(b){b=a.getSelection(b||window);var c,d=b.getAllRanges();b.removeAllRanges();for(var e=d.length;e--;)c=d[e],this.applyToRange(c),b.addRange(c)},undoToRange:function(a){a.splitBoundaries();var b=i(a),c,d,e=b[b.length-1];if(b.length){for(var f=0,g=b.length;f<g;++f)c=b[f],(d=this.getSelfOrAncestorWithClass(c))&&this.isModifiable(c)&&this.undoToTextNode(c,a,d),a.setStart(b[0],0),a.setEnd(e,
e.length);this.normalize&&this.postApply(b,a,!0)}},undoToSelection:function(b){b=a.getSelection(b||window);var c=b.getAllRanges(),d;b.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d=c[e],this.undoToRange(d),b.addRange(d)},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b);d=d?d.toString():"";c.detach();return d},isAppliedToRange:function(a){if(a.collapsed)return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);else{for(var b=a.getNodes([3]),
c=0,d;d=b[c++];)if(!this.isIgnorableWhiteSpaceNode(d)&&h(a,d)&&this.isModifiable(d)&&!this.getSelfOrAncestorWithClass(d))return!1;return!0}},isAppliedToSelection:function(b){b=a.getSelection(b||window).getAllRanges();for(var c=b.length;c--;)if(!this.isAppliedToRange(b[c]))return!1;return!0},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},detach:function(){}};
q.util={hasClass:c,addClass:d,removeClass:B,hasSameClasses:f,replaceWithOwnChildren:g,elementsHaveSameNonClassAttributes:k,elementHasNonClassAttributes:o,splitNodeAt:l,isEditableElement:x,isEditingHost:r,isEditable:n};a.CssClassApplier=q;a.createCssClassApplier=function(a,b,c){return new q(a,b,c)}});
rangy.createModule("SaveRestore",function(a,b){function c(a,b){var c="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),d,e=g.getDocument(a.startContainer),f=a.cloneRange();f.collapse(b);d=e.createElement("span");d.id=c;d.style.lineHeight="0";d.style.display="none";d.className="rangySelectionBoundary";d.appendChild(e.createTextNode(h));f.insertNode(d);f.detach();return d}function d(a,c,d,e){(a=(a||document).getElementById(d))?(c[e?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):
b.warn("Marker element has been removed. Cannot restore selection.")}function e(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function f(a,b){var c=(a||document).getElementById(b);c&&c.parentNode.removeChild(c)}a.requireModules(["DomUtil","DomRange","WrappedRange"]);var g=a.dom,h="\ufeff";a.saveSelection=function(d){d=d||window;var f=d.document;if(a.isSelectionValid(d)){var g=a.getSelection(d),h=g.getAllRanges(),n=[],m,p;h.sort(e);for(var l=0,s=h.length;l<s;++l)m=h[l],m.collapsed?(p=c(m,
!1),n.push({markerId:p.id,collapsed:!0})):(p=c(m,!1),m=c(m,!0),n[l]={startMarkerId:m.id,endMarkerId:p.id,collapsed:!1,backwards:h.length==1&&g.isBackwards()});for(l=s-1;l>=0;--l)m=h[l],m.collapsed?m.collapseBefore((f||document).getElementById(n[l].markerId)):(m.setEndBefore((f||document).getElementById(n[l].endMarkerId)),m.setStartAfter((f||document).getElementById(n[l].startMarkerId)));g.setRanges(h);return{win:d,doc:f,rangeInfos:n,restored:!1}}else b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.")};
a.restoreSelection=function(c,e){if(!c.restored){for(var f=c.rangeInfos,g=a.getSelection(c.win),h=[],m=f.length,p=m-1,l,s;p>=0;--p){l=f[p];s=a.createRange(c.doc);if(l.collapsed)if(l=(c.doc||document).getElementById(l.markerId)){l.style.display="inline";var u=l.previousSibling;u&&u.nodeType==3?(l.parentNode.removeChild(l),s.collapseToPoint(u,u.length)):(s.collapseBefore(l),l.parentNode.removeChild(l))}else b.warn("Marker element has been removed. Cannot restore selection.");else d(c.doc,s,l.startMarkerId,
!0),d(c.doc,s,l.endMarkerId,!1);m==1&&s.normalizeBoundaries();h[p]=s}m==1&&e&&a.features.selectionHasExtend&&f[0].backwards?(g.removeAllRanges(),g.addRange(h[0],!0)):g.setRanges(h);c.restored=!0}};a.removeMarkerElement=f;a.removeMarkers=function(a){for(var b=a.rangeInfos,c=0,d=b.length,e;c<d;++c)e=b[c],e.collapsed?f(a.doc,e.markerId):(f(a.doc,e.startMarkerId),f(a.doc,e.endMarkerId))}});
rangy.createModule("Serializer",function(a,b){function c(a,b){b=b||[];var d=a.nodeType,e=a.childNodes,f=e.length,g=[d,a.nodeName,f].join(":"),h="",i="";switch(d){case 3:h=a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");break;case 8:h="<\!--"+a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"--\>";break;default:h="<"+g+">",i="</>"}h&&b.push(h);for(d=0;d<f;++d)c(e[d],b);i&&b.push(i);return b}function d(a){a=c(a).join("");return r(a).toString(16)}function e(a,b,c){var d=[],e=a;for(c=c||n.getDocument(a).documentElement;e&&
e!=c;)d.push(n.getNodeIndex(e,!0)),e=e.parentNode;return d.join("/")+":"+b}function f(a,c,d){c?d||n.getDocument(c):c=(d||document).documentElement;a=a.split(":");d=a[0]?a[0].split("/"):[];for(var e=d.length,f;e--;)if(f=parseInt(d[e],10),f<c.childNodes.length)c=c.childNodes[parseInt(d[e],10)];else throw b.createError("deserializePosition failed: node "+n.inspectNode(c)+" has no child with index "+f+", "+e);return new n.DomPosition(c,parseInt(a[1],10))}function g(b,c,f){f=f||a.DomRange.getRangeDocument(b).documentElement;
if(!n.isAncestorOf(f,b.commonAncestorContainer,!0))throw Error("serializeRange: range is not wholly contained within specified root node");b=e(b.startContainer,b.startOffset,f)+","+e(b.endContainer,b.endOffset,f);c||(b+="{"+d(f)+"}");return b}function h(b,c,e){c?e=e||n.getDocument(c):(e=e||document,c=e.documentElement);b=/^([^,]+),([^,\{]+)({([^}]+)})?$/.exec(b);var g=b[4],h=d(c);if(g&&g!==d(c))throw Error("deserializeRange: checksums of serialized range root node ("+g+") and target root node ("+
h+") do not match");g=f(b[1],c,e);c=f(b[2],c,e);e=a.createRange(e);e.setStart(g.node,g.offset);e.setEnd(c.node,c.offset);return e}function i(a,b,c){b?c||n.getDocument(b):b=(c||document).documentElement;a=/^([^,]+),([^,]+)({([^}]+)})?$/.exec(a)[3];return!a||a===d(b)}function k(b,c,d){b=b||a.getSelection();b=b.getAllRanges();for(var e=[],f=0,h=b.length;f<h;++f)e[f]=g(b[f],c,d);return e.join("|")}function o(b,c,d){c?d=d||n.getWindow(c):(d=d||window,c=d.document.documentElement);b=b.split("|");for(var e=
a.getSelection(d),f=[],g=0,i=b.length;g<i;++g)f[g]=h(b[g],c,d.document);e.setRanges(f);return e}a.requireModules(["WrappedSelection","WrappedRange"]);(typeof encodeURIComponent=="undefined"||typeof decodeURIComponent=="undefined")&&b.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var r=function(){var a=null;return function(b){for(var c=[],d=0,e=b.length,f;d<e;++d)f=b.charCodeAt(d),f<128?c.push(f):f<2048?c.push(f>>6|192,f&63|128):c.push(f>>12|224,f>>6&63|128,f&
63|128);b=-1;if(!a){d=[];e=0;for(var g;e<256;++e){g=e;for(f=8;f--;)(g&1)==1?g=g>>>1^3988292384:g>>>=1;d[e]=g>>>0}a=d}d=a;e=0;for(f=c.length;e<f;++e)g=(b^c[e])&255,b=b>>>8^d[g];return(b^-1)>>>0}}(),n=a.dom;a.serializePosition=e;a.deserializePosition=f;a.serializeRange=g;a.deserializeRange=h;a.canDeserializeRange=i;a.serializeSelection=k;a.deserializeSelection=o;a.canDeserializeSelection=function(a,b,c){var d;b?d=c?c.document:n.getDocument(b):b=(c||window).document.documentElement;a=a.split("|");c=
0;for(var e=a.length;c<e;++c)if(!i(a[c],b,d))return!1;return!0};a.restoreSelectionFromCookie=function(a){a=a||window;var b;a:{b=a.document.cookie.split(/[;,]/);for(var c=0,d=b.length,e;c<d;++c)if(e=b[c].split("="),e[0].replace(/^\s+/,"")=="rangySerializedSelection"&&(e=e[1])){b=decodeURIComponent(e.replace(/\s+$/,""));break a}b=null}b&&o(b,a.doc)};a.saveSelectionCookie=function(b,c){b=b||window;c=typeof c=="object"?c:{};var d=c.expires?";expires="+c.expires.toUTCString():"",e=c.path?";path="+c.path:
"",f=c.domain?";domain="+c.domain:"",g=c.secure?";secure":"",h=k(a.getSelection(b));b.document.cookie=encodeURIComponent("rangySerializedSelection")+"="+encodeURIComponent(h)+d+e+f+g};a.getElementChecksum=d});if(typeof WYMeditor==="undefined")var WYMeditor={};
(function(){if(typeof window.console==="undefined"&&typeof console==="undefined"){var a=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],b=function(){},c;WYMeditor.console={};for(c=0;c<a.length;c+=1)WYMeditor.console[a[c]]=b}else if(typeof console!=="undefined")WYMeditor.console=console;else if(window.console.firebug)WYMeditor.console=window.console;else if(window.console)WYMeditor.console=window.console})();
jQuery.extend(WYMeditor,{VERSION:"@@VERSION",INSTANCES:[],STRINGS:[],SKINS:[],CUSTOM_COMMANDS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",WYM_PATH:"{Wym_Wym_Path}",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",
CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",NEWLINE:"\n",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",
H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TR:"tr",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",REL:"rel",ALT:"alt",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",
FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote"],FORBIDDEN_MAIN_CONTAINERS:["strong","b","em","i","sub","sup","a","span"],BLOCKS:["address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr"],BLOCKING_ELEMENTS:["table",
"blockquote","pre"],NON_BLOCKING_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6"],LIST_TYPE_ELEMENTS:["ul","ol"],HEADING_ELEMENTS:["h1","h2","h3","h4","h5","h6"],POTENTIAL_LIST_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","td"],POTENTIAL_TABLE_INSERT_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","li"],INLINE_TABLE_INSERTION_ELEMENTS:["li"],SELECTABLE_TABLE_ELEMENTS:["td","th","caption"],BLOCKING_ELEMENT_SPACER_CLASS:"wym-blocking-element-spacer",EDITOR_ONLY_CLASS:"wym-editor-only",
CLASSES_REMOVED_BY_PARSER:["apple-style-span"],KEY:{BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,END:35,HOME:36,CURSOR:[37,38,39,40],LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,B:66,I:73,R:82,COMMAND:224},POTENTIAL_BLOCK_ELEMENT_CREATION_KEYS:[8,13,37,38,39,40,46],EVENTS:{postIframeInitialization:"wym-postIframeInitialization",postBlockMaybeCreated:"wym-postBlockMaybeCreated",documentHTMLUpdated:"wym-documentHTMLUpdated"},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(a,b){this._index=WYMeditor.INSTANCES.push(this)-
1;this._element=a;this._options=b;if(!this._options.html)this._options.html=jQuery(a).val();this._options.wymPath=this._options.wymPath||WYMeditor.computeWymPath();this._options.basePath=this._options.basePath||WYMeditor.computeBasePath(this._options.wymPath);this._options.jQueryPath=this._options.jQueryPath||WYMeditor.computeJqueryPath();this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT;this.init()}});
jQuery.fn.wymeditor=function(a){a=jQuery.extend({html:"",basePath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,skin:"default",lang:"en",direction:"ltr",customCommands:[],structureRules:{defaultRootContainer:"p"},boxHtml:String()+"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div><div class='wym_area_left'></div><div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div><div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div><div class='wym_area_bottom'>"+
WYMeditor.LOGO+"</div></div>",logoHtml:String()+'<a class="wym_wymeditor_link" href="http://www.wymeditor.org/">WYMeditor</a>',iframeHtml:String()+'<div class="wym_iframe wym_section"><iframe src="'+WYMeditor.IFRAME_BASE_PATH+'wymiframe.html"></iframe></div>',toolsHtml:String()+'<div class="wym_tools wym_section"><h2>{Tools}</h2><ul>'+WYMeditor.TOOLS_ITEMS+"</ul></div>",toolsItemHtml:String()+'<li class="'+WYMeditor.TOOL_CLASS+'"><a href="#" name="'+WYMeditor.TOOL_NAME+'" title="'+WYMeditor.TOOL_TITLE+
'">'+WYMeditor.TOOL_TITLE+"</a></li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},
{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",
title:"Preview",css:"wym_tools_preview"}],containersHtml:String()+'<div class="wym_containers wym_section"><h2>{Containers}</h2><ul>'+WYMeditor.CONTAINERS_ITEMS+"</ul></div>",containersItemHtml:String()+'<li class="'+WYMeditor.CONTAINER_CLASS+'"><a href="#" name="'+WYMeditor.CONTAINER_NAME+'">'+WYMeditor.CONTAINER_TITLE+"</a></li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},
{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:String()+'<div class="wym_classes wym_section"><h2>{Classes}</h2><ul>'+WYMeditor.CLASSES_ITEMS+
"</ul></div>",classesItemHtml:String()+'<li class="wym_classes_'+WYMeditor.CLASS_NAME+'"><a href="#" name="'+WYMeditor.CLASS_NAME+'">'+WYMeditor.CLASS_TITLE+"</a></li>",classesItems:[],statusHtml:String()+'<div class="wym_status wym_section"><h2>{Status}</h2></div>',htmlHtml:String()+'<div class="wym_html wym_section"><h2>{Source_Code}</h2><textarea class="wym_html_val"></textarea></div>',boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",
classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",relSelector:".wym_rel",altSelector:".wym_alt",textSelector:".wym_text",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",
summarySelector:".wym_summary",submitSelector:"form",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:"menubar=no,titlebar=no,toolbar=no,resizable=no,width=560,height=300,top=0,left=0",dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",
dialogHtml:String()+'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html dir="'+WYMeditor.DIRECTION+'"><head><title>'+WYMeditor.DIALOG_TITLE+'</title><script type="text/javascript" src="'+WYMeditor.JQUERY_PATH+'"><\/script><script type="text/javascript" src="'+WYMeditor.WYM_PATH+'"><\/script></head>'+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:String()+'<body class="wym_dialog wym_dialog_link"  onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+
')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_LINK+'" /><legend>{Link}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_href" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row"><label>{Relationship}</label><input type="text" class="wym_rel" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogImageHtml:String()+'<body class="wym_dialog wym_dialog_image" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_IMAGE+'" /><legend>{Image}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_src" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Alternative_Text}</label><input type="text" class="wym_alt" value="" size="40" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogTableHtml:String()+'<body class="wym_dialog wym_dialog_table" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_TABLE+'" /><legend>{Table}</legend><div class="row"><label>{Caption}</label><input type="text" class="wym_caption" value="" size="40" /></div><div class="row"><label>{Summary}</label><input type="text" class="wym_summary" value="" size="40" /></div><div class="row"><label>{Number_Of_Rows}</label><input type="text" class="wym_rows" value="3" size="3" /></div><div class="row"><label>{Number_Of_Cols}</label><input type="text" class="wym_cols" value="2" size="3" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogPasteHtml:String()+'<body class="wym_dialog wym_dialog_paste" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_PASTE+'" /><fieldset><legend>{Paste_From_Word}</legend><div class="row"><textarea class="wym_text" rows="10" cols="50" autofocus="autofocus"></textarea></div><div class="row"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',
dialogPreviewHtml:String()+'<body class="wym_dialog wym_dialog_preview" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"></body>',stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},a);return this.each(function(){this._wym=new WYMeditor.editor(jQuery(this),a)})};jQuery.extend({wymeditors:function(a){return WYMeditor.INSTANCES[a]}});
WYMeditor.computeWymPath=function(){var a=jQuery(jQuery.grep(jQuery("script"),function(a){if(!a.src)return null;return a.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)||a.src.match(/\/core\.js(\?.*)?$/)}));if(a.length>0)return a.attr("src");WYMeditor.console.warn("Error determining wymPath. No base WYMeditor file located.");WYMeditor.console.warn("Assuming wymPath to be the current URL");WYMeditor.console.warn("Please pass a correct wymPath option");return""};
WYMeditor.computeBasePath=function(a){var b=a.lastIndexOf("/");return a.substr(0,b+1)};WYMeditor.computeJqueryPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(a){return a.src&&a.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")};
WYMeditor.INIT_DIALOG=function(a){var b=window.opener.WYMeditor.INSTANCES[a],c=b.selected();a=jQuery(b._options.dialogTypeSelector).val();var d=b.uniqueStamp();a===WYMeditor.DIALOG_LINK&&(c&&c.tagName&&c.tagName.toLowerCase!==WYMeditor.A&&(c=jQuery(c).parentsOrSelf(WYMeditor.A)),!c&&b._selectedImage&&(c=jQuery(b._selectedImage).parentsOrSelf(WYMeditor.A)));jQuery.isFunction(b._options.preInitDialog)&&b._options.preInitDialog(b,window);c&&(jQuery(b._options.hrefSelector).val(jQuery(c).attr(WYMeditor.HREF)),
jQuery(b._options.srcSelector).val(jQuery(c).attr(WYMeditor.SRC)),jQuery(b._options.titleSelector).val(jQuery(c).attr(WYMeditor.TITLE)),jQuery(b._options.relSelector).val(jQuery(c).attr(WYMeditor.REL)),jQuery(b._options.altSelector).val(jQuery(c).attr(WYMeditor.ALT)));b._selectedImage&&(jQuery(b._options.dialogImageSelector+" "+b._options.srcSelector).val(jQuery(b._selectedImage).attr(WYMeditor.SRC)),jQuery(b._options.dialogImageSelector+" "+b._options.titleSelector).val(jQuery(b._selectedImage).attr(WYMeditor.TITLE)),
jQuery(b._options.dialogImageSelector+" "+b._options.altSelector).val(jQuery(b._selectedImage).attr(WYMeditor.ALT)));jQuery(b._options.dialogLinkSelector+" "+b._options.submitSelector).submit(function(){var a=jQuery(b._options.hrefSelector).val(),f;a.length>0&&(c[0]&&c[0].tagName.toLowerCase()===WYMeditor.A?f=c:(b._exec(WYMeditor.CREATE_LINK,d),f=jQuery("a[href="+d+"]",b._doc.body)),f.attr(WYMeditor.HREF,a),f.attr(WYMeditor.TITLE,jQuery(b._options.titleSelector).val()),f.attr(WYMeditor.REL,jQuery(b._options.relSelector).val()));
window.close()});jQuery(b._options.dialogImageSelector+" "+b._options.submitSelector).submit(function(){var a=jQuery(b._options.srcSelector).val(),c;a.length>0&&(b._exec(WYMeditor.INSERT_IMAGE,d),c=jQuery("img[src$="+d+"]",b._doc.body),c.attr(WYMeditor.SRC,a),c.attr(WYMeditor.TITLE,jQuery(b._options.titleSelector).val()),c.attr(WYMeditor.ALT,jQuery(b._options.altSelector).val()));window.close()});a=WYMeditor.MAKE_TABLE_ONCLICK(b);jQuery(b._options.dialogTableSelector+" "+b._options.submitSelector).submit(a);
jQuery(b._options.dialogPasteSelector+" "+b._options.submitSelector).submit(function(){var a=jQuery(b._options.textSelector).val();b.paste(a);window.close()});jQuery(b._options.dialogPreviewSelector+" "+b._options.previewSelector).html(b.xhtml());jQuery(b._options.cancelSelector).mousedown(function(){window.close()});jQuery.isFunction(b._options.postInitDialog)&&b._options.postInitDialog(b,window)};
WYMeditor.MAKE_TABLE_ONCLICK=function(a){return function(){var b=jQuery(a._options.rowsSelector).val(),c=jQuery(a._options.colsSelector).val(),d=jQuery(a._options.captionSelector).val(),e=jQuery(a._options.summarySelector).val();a.insertTable(b,c,d,e);window.close()}};jQuery.fn.isPhantomNode=function(){if(this[0].nodeType===3)return!/[^\t\n\r ]/.test(this[0].data);return!1};
jQuery.fn.nextContentsUntil=function(a,b){var c=[],d=this.get(0);a=a?a:"";b=b?b:"";if(!d)return jQuery();for(d=d.nextSibling;d;)if(jQuery(d).is(a))break;else c.push(d),d=d.nextSibling;c=jQuery(c);if(b)return c.filter(b);return c};jQuery.fn.nextAllContents=function(){return jQuery(this).nextContentsUntil("","")};
jQuery.fn.prevContentsUntil=function(a,b){var c=[],d=this.get(0);a=a?a:"";b=b?b:"";if(!d)return jQuery();for(d=d.previousSibling;d;)if(jQuery(d).is(a))break;else c.push(d),d=d.previousSibling;c=jQuery(c);if(b)return c.filter(b);return c};jQuery.fn.prevAllContents=function(){return jQuery(this).prevContentsUntil("","")};WYMeditor.isPhantomNode=function(a){if(a.nodeType===3)return!/[^\t\n\r ]/.test(a.data);return!1};WYMeditor.isPhantomString=function(a){return!/[^\t\n\r ]/.test(a)};
jQuery.fn.parentsOrSelf=function(a){var b=this;b[0].nodeType===3&&(b=b.parents().slice(0,1));return b.filter(a).size()===1?b:b.parents(a).slice(0,1)};WYMeditor.changeNodeType=function(a,b){var c,d,e=a.attributes;jQuery(a).wrapInner("<"+b+">");c=jQuery(a).children().get(0);for(d=0;d<e.length;d++)e[d].specified&&c.setAttribute(e[d].nodeName,e[d].nodeValue);jQuery(a).contents().unwrap();return c};
WYMeditor.Helper={replaceAll:function(a,b,c){return a.replace(RegExp(b,"g"),c)},insertAt:function(a,b,c){return a.substr(0,c)+b+a.substring(c)},trim:function(a){return jQuery.trim(a)},contains:function(a,b){var c;for(c=0;c<a.length;c+=1)if(a[c]===b)return!0;return!1},indexOf:function(a,b){var c=-1,d;for(d=0;d<a.length;d+=1)if(a[d]===b){c=d;break}return c},findByName:function(a,b){var c,d;for(c=0;c<a.length;c+=1)if(d=a[c],d.name===b)return d;return null}};
WYMeditor.XmlHelper=function(){this._entitiesDiv=document.createElement("div");return this};WYMeditor.XmlHelper.prototype.tag=function(a,b,c){b=b||!1;c=c||!1;return"<"+a+(b?this.tagOptions(b):"")+(c?">":" />")};WYMeditor.XmlHelper.prototype.contentTag=function(a,b,c){c=c||!1;return"<"+a+(c?this.tagOptions(c):"")+">"+b+"</"+a+">"};WYMeditor.XmlHelper.prototype.cdataSection=function(a){return"<![CDATA["+a+"]]\>"};WYMeditor.XmlHelper.prototype.escapeOnce=function(a){return this._fixDoubleEscape(this.escapeEntities(a))};
WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(a){return a.replace(/&amp;([a-z]+|(#\d+));/ig,"&$1;")};WYMeditor.XmlHelper.prototype.tagOptions=function(a){this._formated_options="";for(var b in a){var c=a[b];typeof c!="function"&&c.length>0&&(parseInt(b,10)==b&&typeof c=="object"&&(b=c.shift(),c=c.pop()),b!==""&&c!==""&&(this._formated_options+=" "+b+'="'+this.escapeOnce(c)+'"'))}return this._formated_options};
WYMeditor.XmlHelper.prototype.escapeEntities=function(a,b){this._entitiesDiv.innerHTML=a;this._entitiesDiv.textContent=a;var c=this._entitiesDiv.innerHTML;typeof b=="undefined"&&(b!==!1&&(c=c.replace('"',"&quot;")),b===!0&&(c=c.replace('"',"&#039;")));return c};
WYMeditor.XmlHelper.prototype.parseAttributes=function(a){var b=[],c=a.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(c.toString()!=a)for(var d in c){var e=c[d];if(typeof e!="function"&&e.length!==0){var f=a.match(RegExp("(\\w+)\\s*"+e));if(f){e=e.replace(/^[\s=]+/,"");var g=e.charAt(0);g=g=='"'?'"':g=="'"?"'":"";g!==""&&(e=g=='"'?e.replace(/^"|"+$/g,""):e.replace(/^'|'+$/g,""));a=a.replace(f[0],"");b.push([f[1],e])}}}return b};
WYMeditor.DocumentStructureManager=function(a,b){this._wym=a;this.structureRules=WYMeditor.DocumentStructureManager.DEFAULTS;this.setDefaultRootContainer(b)};
jQuery.extend(WYMeditor.DocumentStructureManager,{VALID_DEFAULT_ROOT_CONTAINERS:["p","div"],DEFAULT_ROOT_CONTAINER_TITLES:{p:"Paragraph",div:"Division"},CONTAINERS_BLOCKING_NAVIGATION:["table","blockquote","pre"],DEFAULTS:{defaultRootContainer:"p",notValidRootContainers:["div"],validRootContainers:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","table","ol","ul"],convertIfRootContainers:["div"],validListConversionTargetContainers:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote",
"td","th"],wrapContentsInList:["td","th"]}});
WYMeditor.DocumentStructureManager.prototype.setDefaultRootContainer=function(a){var b;if(this.structureRules.defaultRootContainer!==a){b=WYMeditor.DocumentStructureManager;b=jQuery.inArray(a,b.VALID_DEFAULT_ROOT_CONTAINERS);if(b===-1)throw Error("a defaultRootContainer of '"+a+"' is not supported");this.structureRules.defaultRootContainer=a;this.structureRules.notValidRootContainers=WYMeditor.DocumentStructureManager.VALID_DEFAULT_ROOT_CONTAINERS;this.structureRules.notValidRootContainers.splice(b,1);
this.adjustDefaultRootContainerUI()}};
WYMeditor.DocumentStructureManager.prototype.adjustDefaultRootContainerUI=function(){var a=this._wym,b=this.structureRules.defaultRootContainer,c,d,e,f;c=jQuery(a._box).find(a._options.containersSelector).find("li");e=!0;for(f=0;f<c.length;++f)d=c.eq(f).find("a"),d=d.attr("name").toLowerCase(),jQuery.inArray(d,this.structureRules.notValidRootContainers)>-1&&c.eq(f).remove(),d===b&&(e=!1);if(e)c=a._options.containersItemHtml,c=WYMeditor.Helper.replaceAll(c,WYMeditor.CONTAINER_NAME,b.toUpperCase()),
e=WYMeditor.DocumentStructureManager,c=WYMeditor.Helper.replaceAll(c,WYMeditor.CONTAINER_TITLE,e.DEFAULT_ROOT_CONTAINER_TITLES[b]),c=WYMeditor.Helper.replaceAll(c,WYMeditor.CONTAINER_CLASS,"wym_containers_"+b),b=jQuery(c),c=jQuery(a._box).find(a._options.containersSelector).find("li"),c.eq(0).before(b),b.find("a").click(function(){a.container(jQuery(this).attr(WYMeditor.NAME));return!1})};
WYMeditor.editor.prototype.init=function(){var a=!1,b,c,d,e,f,g,h;if(jQuery.browser.msie)a=new WYMeditor.WymClassExplorer(this);else if(jQuery.browser.mozilla)a=new WYMeditor.WymClassMozilla(this);else if(jQuery.browser.opera)a=new WYMeditor.WymClassOpera(this);else if(jQuery.browser.safari||jQuery.browser.webkit||jQuery.browser.chrome)a=new WYMeditor.WymClassSafari(this);if(a!==!1){jQuery.isFunction(this._options.preInit)&&this._options.preInit(this);this.helper=this.parser=null;if(!this._options.disable_sanitization)b=
new WYMeditor.XhtmlSaxListener,this.parser=new WYMeditor.XhtmlParser(b);this.helper=new WYMeditor.XmlHelper;for(c in a)this[c]=a[c];h=this;h._box=jQuery(h._element).hide().after(h._options.boxHtml).next().addClass("wym_box_"+h._index);jQuery.isFunction(jQuery.fn.data)&&(jQuery.data(h._box.get(0),WYMeditor.WYM_INDEX,h._index),jQuery.data(h._element.get(0),WYMeditor.WYM_INDEX,h._index));a=WYMeditor.Helper;c=h._options.iframeHtml;c=a.replaceAll(c,WYMeditor.INDEX,h._index);c=a.replaceAll(c,WYMeditor.IFRAME_BASE_PATH,
h._options.iframeBasePath);b=jQuery(h._box).html();b=a.replaceAll(b,WYMeditor.LOGO,h._options.logoHtml);b=a.replaceAll(b,WYMeditor.TOOLS,h._options.toolsHtml);b=a.replaceAll(b,WYMeditor.CONTAINERS,h._options.containersHtml);b=a.replaceAll(b,WYMeditor.CLASSES,h._options.classesHtml);b=a.replaceAll(b,WYMeditor.HTML,h._options.htmlHtml);b=a.replaceAll(b,WYMeditor.IFRAME,c);b=a.replaceAll(b,WYMeditor.STATUS,h._options.statusHtml);d=eval(h._options.toolsItems);e="";for(c=0;c<d.length;c+=1){f=d[c];if(f.html)g=
f.html;else{g="";if(f.name&&f.title)g=h._options.toolsItemHtml;g=a.replaceAll(g,WYMeditor.TOOL_NAME,f.name);g=a.replaceAll(g,WYMeditor.TOOL_TITLE,h._options.stringDelimiterLeft+f.title+h._options.stringDelimiterRight);g=a.replaceAll(g,WYMeditor.TOOL_CLASS,f.css)}e+=g}b=a.replaceAll(b,WYMeditor.TOOLS_ITEMS,e);d=eval(h._options.classesItems);e="";for(c=0;c<d.length;c+=1){f=d[c];g="";if(f.name&&f.title)g=h._options.classesItemHtml;g=a.replaceAll(g,WYMeditor.CLASS_NAME,f.name);g=a.replaceAll(g,WYMeditor.CLASS_TITLE,
f.title);e+=g}b=a.replaceAll(b,WYMeditor.CLASSES_ITEMS,e);d=eval(h._options.containersItems);e="";for(c=0;c<d.length;c+=1){g=d[c];f="";if(g.name&&g.title)f=h._options.containersItemHtml;f=a.replaceAll(f,WYMeditor.CONTAINER_NAME,g.name);f=a.replaceAll(f,WYMeditor.CONTAINER_TITLE,h._options.stringDelimiterLeft+g.title+h._options.stringDelimiterRight);f=a.replaceAll(f,WYMeditor.CONTAINER_CLASS,g.css);e+=f}b=a.replaceAll(b,WYMeditor.CONTAINERS_ITEMS,e);b=h.replaceStrings(b);jQuery(h._box).html(b);jQuery(h._box).find(h._options.htmlSelector).hide();
h.documentStructureManager=new WYMeditor.DocumentStructureManager(h,h._options.structureRules.defaultRootContainer);h._iframe_initialized=!1;jQuery(h._box).find("iframe").load(function(){if(h._iframe_initialized!==!0)h._iframe_initialized=h.initIframe(this)});h.initSkin()}};
WYMeditor.editor.prototype.bindEvents=function(){var a=this,b;jQuery(this._box).find(this._options.toolSelector).click(function(b){a._iframe.contentWindow.focus();a.exec(jQuery(this).attr(WYMeditor.NAME));b.preventDefault()});jQuery(this._box).find(this._options.containerSelector).click(function(b){a.container(jQuery(this).attr(WYMeditor.NAME));b.preventDefault()});b=jQuery(this._box).find(this._options.htmlValSelector);b.keyup(function(){jQuery(a._doc.body).html(jQuery(this).val())});b.focus(function(){jQuery(this).toggleClass("hasfocus")});
b.blur(function(){jQuery(this).toggleClass("hasfocus")});this._element.bind("change",function(){jQuery(a._doc.body).html(jQuery(this).val())});jQuery(this._box).find(this._options.classSelector).click(function(b){var d=eval(a._options.classesItems),e=jQuery(this).attr(WYMeditor.NAME);if(d=WYMeditor.Helper.findByName(d,e))d=d.expr,a.toggleClass(e,d);a._iframe.contentWindow.focus();b.preventDefault()});jQuery(this._options.updateSelector).bind(this._options.updateEvent,function(){a.update(!0)})};
WYMeditor.editor.prototype.ready=function(){return this._doc!==null};WYMeditor.editor.prototype.box=function(){return this._box};WYMeditor.editor.prototype._html=function(a){if(typeof a==="string")jQuery(this._doc.body).html(a),this.update();else return jQuery(this._doc.body).html()};
WYMeditor.editor.prototype.html=function(a){WYMeditor.console.warn("The function WYMeditor.editor.html() is deprecated. Use either WYMeditor.editor.xhtml() or WYMeditor.editor._html() instead.");if(typeof a==="string")this._html(a);else return this._html()};WYMeditor.editor.prototype.xhtml=function(){return this._options.disable_sanitization?this._html():this.parser.parse(this._html())};
WYMeditor.editor.prototype.exec=function(a,b){var c,d,e=this;switch(a){case WYMeditor.CREATE_LINK:((c=this.container())||this._selectedImage)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.UNLINK:if(this.selection&&this.selection_collapsed()&&(c=this.selected_parents_contains("a"),c.length)){c.each(function(){jQuery(this).replaceWith(this.childNodes)});break}this._exec(a);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);
break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(this.xhtml());this.toggleHtml();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW,this._options.dialogFeaturesPreview);break;case WYMeditor.INSERT_ORDEREDLIST:this.insertOrderedlist();break;case WYMeditor.INSERT_UNORDEREDLIST:this.insertUnorderedlist();break;case WYMeditor.INDENT:this.indent();break;case WYMeditor.OUTDENT:this.outdent();
break;default:c=jQuery.merge([],this._options.customCommands),jQuery.merge(c,WYMeditor.CUSTOM_COMMANDS),jQuery.each(c,function(){if(a===this.name)return d=!0,this.run.apply(e,b),!1}),d||this._exec(a)}a!==WYMeditor.TOGGLE_HTML&&(this.update_selections(),this._element.trigger(WYMeditor.EVENTS.documentHTMLUpdated,[this,jQuery(this._doc.body).html()]))};WYMeditor.editor.prototype.selection=function(){window.rangy&&!rangy.initialized&&rangy.init();return rangy.getIframeSelection(this._iframe)};
WYMeditor.editor.prototype.selected=function(){var a=this.selection(),b=a.focusNode,c,d;if(b){if(jQuery.browser.msie&&(c=b.tagName&&b.tagName.toLowerCase()==="body",d=b.nodeName==="#text",a.isCollapsed&&(c||d)))(a=this._iframe.contentWindow.document.caretPos)&&a.parentElement&&(b=a.parentElement());return b.nodeName==="#text"?b.parentNode:b}else return null};
WYMeditor.editor.prototype.selection_collapsed=function(){var a=this.selection(),b=!1;jQuery.each(a.getAllRanges(),function(){if(this.collapsed)return b=!0,!1});return b};WYMeditor.editor.prototype.selected_contains=function(a){var b=this.selection(),c=[];jQuery.each(b.getAllRanges(),function(){jQuery.each(this.getNodes(),function(){jQuery(this).is(a)&&c.push(this)})});return c};
WYMeditor.editor.prototype.selected_parents_contains=function(a){var b=jQuery([]),c=jQuery(this.selected());c.is(a)&&(b=b.add(c));return b=b.add(c.parents(a))};
WYMeditor.editor.prototype.container=function(a){if(typeof a==="undefined")return this.selected();var b=null,c,d,e;if(a.toLowerCase()===WYMeditor.TH){b=this.container();switch(b.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:c=[WYMeditor.TD,WYMeditor.TH],b=this.findUp(this.container(),c)}if(b!==null){a=WYMeditor.TD;if(b.tagName.toLowerCase()===WYMeditor.TD)a=WYMeditor.TH;this.switchTo(b,a,!1);this.update()}}else if(c=[WYMeditor.P,WYMeditor.DIV,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,
WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE],b=this.findUp(this.container(),c)){if(a.toLowerCase()===WYMeditor.BLOCKQUOTE)if(c=this.findUp(this.container(),WYMeditor.BLOCKQUOTE),c===null)d=this._doc.createElement(a),b.parentNode.insertBefore(d,b),d.appendChild(b),this.setFocusToNode(d.firstChild);else{a=c.childNodes;b=a.length;b>0&&(d=a.item(0));for(e=0;e<b;e+=1)c.parentNode.insertBefore(a.item(0),c);c.parentNode.removeChild(c);d&&this.setFocusToNode(d)}else this.switchTo(b,
a);this.update()}return!1};WYMeditor.editor.prototype.isForbiddenMainContainer=function(a){return jQuery.inArray(a.toLowerCase(),WYMeditor.FORBIDDEN_MAIN_CONTAINERS)>-1};WYMeditor.editor.prototype.keyCanCreateBlockElement=function(a){return jQuery.inArray(a,WYMeditor.POTENTIAL_BLOCK_ELEMENT_CREATION_KEYS)>-1};
WYMeditor.editor.prototype.toggleClass=function(a,b){var c=null;c=this._selectedImage?this._selectedImage:jQuery(this.selected());c=jQuery(c).parentsOrSelf(b);jQuery(c).toggleClass(a);jQuery(c).attr(WYMeditor.CLASS)||jQuery(c).removeAttr(this._class)};
WYMeditor.editor.prototype.findUp=function(a,b){if(typeof a==="undefined"||a===null)return null;if(a.nodeName==="#text")a=a.parentNode;var c=a.tagName.toLowerCase(),d,e;if(typeof b===WYMeditor.STRING)for(;c!==b&&c!==WYMeditor.BODY;)a=a.parentNode,c=a.tagName.toLowerCase();else for(d=!1;!d&&c!==WYMeditor.BODY;){for(e=0;e<b.length;e+=1)if(c===b[e]){d=!0;break}if(!d){a=a.parentNode;if(a===null)return null;c=a.tagName.toLowerCase()}}if(c===WYMeditor.BODY)return null;return a};
WYMeditor.editor.prototype.switchTo=function(a,b,c){b=this._doc.createElement(b);var d=jQuery(a).html(),e=a.attributes;if(!c)for(c=0;c<e.length;++c)b.setAttribute(e.item(c).nodeName,e.item(c).nodeValue);b.innerHTML=d;a.parentNode.replaceChild(b,a);this.setFocusToNode(b)};
WYMeditor.editor.prototype.replaceStrings=function(a){var b;if(!WYMeditor.STRINGS[this._options.lang])return WYMeditor.console.error("WYMeditor: language '"+this._options.lang+"' not found."),WYMeditor.console.error("Unable to perform i10n."),a;for(b in WYMeditor.STRINGS[this._options.lang])WYMeditor.STRINGS[this._options.lang].hasOwnProperty(b)&&(a=WYMeditor.Helper.replaceAll(a,this._options.stringDelimiterLeft+b+this._options.stringDelimiterRight,WYMeditor.STRINGS[this._options.lang][b]));return a};
WYMeditor.editor.prototype.encloseString=function(a){return this._options.stringDelimiterLeft+a+this._options.stringDelimiterRight};WYMeditor.editor.prototype.status=function(a){jQuery(this._box).find(this._options.statusSelector).html(a)};WYMeditor.editor.prototype.update=function(a){this._options.before_update&&a&&this._options.before_update.apply(this);a=this.xhtml();jQuery(this._element).val(a);jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(a);this.fixBodyHtml()};
WYMeditor.editor.prototype.fixBodyHtml=function(){this.spaceBlockingElements();this.fixDoubleBr();jQuery(this._element).trigger(WYMeditor.EVENTS.postBlockMaybeCreated,this)};
WYMeditor.editor.prototype.spaceBlockingElements=function(){var a=WYMeditor.DocumentStructureManager.CONTAINERS_BLOCKING_NAVIGATION.join(", "),b=jQuery(this._doc).find("body.wym_iframe"),c=b.children(),d,e;d=jQuery.browser.mozilla?'<br class="'+WYMeditor.BLOCKING_ELEMENT_SPACER_CLASS+" "+WYMeditor.EDITOR_ONLY_CLASS+'" _moz_editor_bogus_node="TRUE" _moz_dirty=""/>':'<br class="'+WYMeditor.BLOCKING_ELEMENT_SPACER_CLASS+" "+WYMeditor.EDITOR_ONLY_CLASS+'"/>';c.length>0&&(e=jQuery(c[0]),c=jQuery(c[c.length-
1]),e.is(a)&&e.before(d),c.is(a)&&!(jQuery.browser.msie&&jQuery.browser.version<"7.0")&&c.after(d));e=this._getBlockSepSelector();b.find(e).before(d);e=this._getBlockInListSepSelector();b.find(e).each(function(){var b=jQuery(this);!b.next(a).length&&!b.next(WYMeditor.BR).length&&b.after(d)})};
WYMeditor.editor.prototype._getBlockSepSelector=function(){if(typeof this._blockSpacersSel!=="undefined")return this._blockSpacersSel;var a=[],b=WYMeditor.DocumentStructureManager.CONTAINERS_BLOCKING_NAVIGATION,c;c=jQuery.grep(this.documentStructureManager.structureRules.validRootContainers,function(a){return jQuery.inArray(a,b)===-1});jQuery.each(b,function(c,e){jQuery.each(b,function(b,c){a.push(e+" + "+c)})});jQuery.each(b,function(b,e){jQuery.each(c,function(b,c){a.push(e+" + "+c);a.push(c+" + "+
e)})});return this._blockSpacersSel=a.join(", ")};WYMeditor.editor.prototype._getBlockInListSepSelector=function(){if(typeof this._blockInListSpacersSel!=="undefined")return this._blockInListSpacersSel;var a=[];jQuery.each(WYMeditor.LIST_TYPE_ELEMENTS,function(b,c){jQuery.each(WYMeditor.BLOCKING_ELEMENTS,function(b,e){a.push(c+" "+e)})});return this._blockInListSpacersSel=a.join(", ")};
WYMeditor.editor.prototype.fixDoubleBr=function(){var a=jQuery(this._doc).find("body.wym_iframe");a.children("br + br").filter(":not(pre br)").remove();a.find("p + br").next("p").prev("br").remove();a=a.find("p + br").slice(-1);a.length>0&&a.next().length===0&&a.remove()};
WYMeditor.editor.prototype.dialog=function(a,b,c){b=window.open("","dialog",b||this._wym._options.dialogFeatures);var d,e=WYMeditor.Helper;if(b){switch(a){case WYMeditor.DIALOG_LINK:d=this._options.dialogLinkHtml;break;case WYMeditor.DIALOG_IMAGE:d=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:d=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:d=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:d=this._options.dialogPreviewHtml;break;default:d=c}c=this._options.dialogHtml;
c=e.replaceAll(c,WYMeditor.BASE_PATH,this._options.basePath);c=e.replaceAll(c,WYMeditor.DIRECTION,this._options.direction);c=e.replaceAll(c,WYMeditor.WYM_PATH,this._options.wymPath);c=e.replaceAll(c,WYMeditor.JQUERY_PATH,this._options.jQueryPath);c=e.replaceAll(c,WYMeditor.DIALOG_TITLE,this.encloseString(a));c=e.replaceAll(c,WYMeditor.DIALOG_BODY,d);c=e.replaceAll(c,WYMeditor.INDEX,this._index);c=this.replaceStrings(c);a=b.document;a.write(c);a.close()}};
WYMeditor.editor.prototype.toggleHtml=function(){var a=jQuery(this._box).find(this._options.htmlSelector),b=jQuery(this._box).find(".wym_iframe"),c=this._box.find(".wym_tools_html");a.is(":visible")?(a.hide(),c.removeClass("selected"),jQuery(this._box).find(".ui-resizable-handle").show(),b.css("visibility","visible"),jQuery(this._doc).focus()):(a.show(),a.find("textarea").height(b.height()-10),a.find("textarea").width(b.width()-10),c.addClass("selected"),b.css("visibility","hidden"),jQuery(this._box).find(".ui-resizable-handle").hide())};
WYMeditor.editor.prototype.uniqueStamp=function(){return"wym-"+(new Date).getTime()};
WYMeditor.editor.prototype._handleMultilineBlockContainerPaste=function(a,b,c,d){var e,f,g,h,i,k;e=jQuery(e);g="p";b.is("li")&&(g="li");c.splitBoundaries();e=a.findUp(c.startContainer,["p","h1","h2","h3","h4","h5","h6","li"]);f=e.tagName;h=[];i=[];jQuery(e).contents().each(function(a,b){k=c.compareNode(b);k===c.NODE_BEFORE||k===c.NODE_BEFORE_AND_AFTER&&c.startOffset===c.startContainer.length?h.push(b):i.push(b)});for(b=0;b<h.length;b++)jQuery(h[b]).remove();for(b=0;b<i.length;b++)jQuery(i[b]).remove();
h.length>0&&jQuery(e).prepend(h);i.length>0&&(b=jQuery("<"+f+"></"+f+">",a._doc),b.insertAfter(jQuery(e)),b.append(i));b=d.splice(0,1)[0].split(WYMeditor.NEWLINE).join("<br />");jQuery(e).html(jQuery(e).html()+b);e=jQuery(e);for(b=0;b<d.length;b++)f="<"+g+">"+d[b].split(WYMeditor.NEWLINE).join("<br />")+"</"+g+">",e=jQuery(f,a._doc).insertAfter(e)};
WYMeditor.editor.prototype.paste=function(a){var b=this.selected(),c,d;d="";var e=!1,f,g;f=rangy.getIframeSelection(this._iframe);g=f.getRangeAt(0);d=jQuery(b);g.collapse(!0);c=a.split(RegExp(WYMeditor.NEWLINE+"{2,}","g"));c.length===1&&(e=!0);if(typeof b==="undefined"||b&&b.tagName.toLowerCase()===WYMeditor.BODY)if(e)jQuery("<p>"+c[0]+"</p>",this._doc).appendTo(this._doc.body);else for(a=c.length-1;a>=0;a-=1){d="<p>"+c[a].split(WYMeditor.NEWLINE).join("<br />")+"</p>";e=jQuery(d,this._doc);for(d=
e.length-1;d>=0;d--)g.insertNode(e[d])}else if(e||d.is("pre"))d=this._doc.createTextNode(a),g.insertNode(d);else if(d.is("p,h1,h2,h3,h4,h5,h6,li"))this._handleMultilineBlockContainerPaste(this,d,g,c);else{c=a.split(WYMeditor.NEWLINE);for(a=c.length-1;a>=0;a-=1)d=this._doc.createTextNode(c[a]),g.insertNode(d),a>0&&g.insertNode(jQuery("<br />",this._doc).get(0))}jQuery(b).text()===""&&jQuery(b).remove();jQuery("body > br",this._doc).remove();this.setFocusToNode(f.focusNode)};
WYMeditor.editor.prototype.insert=function(a){var b=this._iframe.contentWindow.getSelection();b.focusNode!==null?(b=b.getRangeAt(0),a=b.createContextualFragment(a),b.deleteContents(),b.insertNode(a)):this.paste(a)};
WYMeditor.editor.prototype.insertBlock=function(a){var b=this.selection(),c,d=b.focusNode,e=b.focusOffset,f="after";if(d&&(c=jQuery(d).closest("div, p, h1, h2, h3, embed, cite")[0])&&c!==d)d.nodeType===3&&e>0&&e<d.length&&rangy.dom.splitDataNode(d,e),rangy.CssClassApplier.util.splitNodeAt(c,d,e);e===0&&(f="before");b.deleteFromDocument();this.insert_next(a,f)};WYMeditor.editor.prototype.insertText=function(a){var b;b=this.selection().getRangeAt(0);b.deleteContents();b.insertNode(document.createTextNode(a))};
WYMeditor.editor.prototype.insert_next=function(a,b){var c=this.selected(),d=jQuery(c),e=d.closest("blockquote");b||(b="after");c!==null?d.is("body")?b==="after"?d.append(a):d.prepend(a):(e.length?b==="after"?e.after(a):e.before(a):(c=d.closest("div, p, h1, h2, h3, embed, cite"),c.length?b==="after"?c.after(a):c.before(a):b==="after"?d.closest("body").append(a):d.closest("body").prepend(a)),c=d.clone(),c.find("br, span").remove(),c.is(":empty")&&d.remove(),c.remove()):jQuery(this._doc.body).prepend(a);
jQuery(this._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[this,jQuery(this._doc.body).html()])};WYMeditor.editor.prototype.insert_empty_p_if_next_block_is_uneditable=function(){jQuery("[contenteditable=false]",this._doc).each(function(){var a=jQuery(this),b=a.next();b.length&&b[0].contentEditable!=="false"&&!b.is("span.rangySelectionBoundary")?b.height()||b.append("&nbsp;"):a.after("<p>&nbsp;</p>")})};
WYMeditor.editor.prototype.wrap=function(a,b){this.insert(a+this._iframe.contentWindow.getSelection().toString()+b)};WYMeditor.editor.prototype.unwrap=function(){this.insert(this._iframe.contentWindow.getSelection().toString())};WYMeditor.editor.prototype.setFocusToNode=function(a,b){var c=rangy.createRange(this._doc),d=rangy.getIframeSelection(this._iframe);b=b||!1;c.selectNodeContents(a);c.collapse(b);d.setSingleRange(c)};
WYMeditor.editor.prototype.splitListItemContents=function(a){var b,c,d=!1,e={itemContents:[],sublistContents:[]};a=a.contents();for(b=0;b<a.length;b++)c=a.get(b),d||jQuery(c).is("ol,ul")?(d=!0,e.sublistContents.push(c)):e.itemContents.push(c);return e};WYMeditor.editor.prototype.joinAdjacentLists=function(a,b){var c;typeof a==="undefined"||typeof b==="undefined"||a.nextSibling!==b||a.tagName.toLowerCase()!==b.tagName.toLowerCase()||(c=jQuery(b).contents(),c.unwrap(),c.detach(),jQuery(a).append(c))};
WYMeditor.editor.prototype._indentSingleItem=function(a){var b,c,d,e;a=jQuery(a);b=a.parent()[0].tagName.toLowerCase();c=this.splitListItemContents(a);d=jQuery(c.sublistContents);jQuery(c.itemContents);e=a.prev().filter("li");e.length===0&&(a.before('<li class="spacer_li"></li>'),e=a.prev());c=e.contents().last().filter("ol,ul");c.length>0?(c.append(a),d.detach(),e.append(d),b=d.first(),this.joinAdjacentLists(c.get(0),b.get(0))):(d.length>0?(d.detach(),e.append(d),c=d.first()):(e.append("<"+b+"></"+
b+">"),c=e.contents().last()),c.prepend(a));a.next().is(".spacer_li")&&(b=a.next(".spacer_li"),d=b.contents(),d.detach(),a.append(d),b.remove())};
WYMeditor.editor.prototype._outdentSingleItem=function(a){var b,c,d,e,f,g,h;b=jQuery(a);c=b.parent()[0].tagName.toLowerCase();b.parent().parent().is("ol,ul,li")&&(b.parent().parent().is("li")||(WYMeditor.console.log("Attempting to fix invalid list nesting before outdenting."),this.correctInvalidListNesting(a)),d=this.splitListItemContents(b),a=jQuery(d.sublistContents),jQuery(d.itemContents),d=b.parent().parent("li"),d.length===0?WYMeditor.console.error("Invalid list. No parentLi found, so aborting outdent"):
(e=b.parent(),f=b.nextAllContents(),g=e.nextAllContents(),b.detach(),d.after(b),a.length>0&&(b.append("<"+c+'><li class="spacer_li"></li></'+c+">"),h=b.children().last(),a.detach(),h.children("li").append(a)),f.length>0&&(typeof h==="undefined"&&(b.append("<"+c+"></"+c+">"),h=b.children().last()),f.detach(),h.append(f)),g.length>0&&(g.detach(),b.contents().length>0&&b.contents().last()[0].nodeType===WYMeditor.NODE.TEXT&&g[0].nodeType===WYMeditor.NODE.TEXT&&b.append("<br />"),b.append(g)),e.contents().length===
0&&e.remove(),d.contents().length===0&&d.remove()))};
WYMeditor.editor.prototype.correctInvalidListNesting=function(a,b){var c=a,d,e;typeof b==="undefined"&&(b=!1);if(!c)return b;for(;c.parentNode;){d=c.parentNode;if(d.nodeType!==WYMeditor.NODE.ELEMENT)break;e=d.tagName.toLowerCase();if(e!=="ol"&&e!=="ul"&&e!=="li")break;c=d}if(jQuery(c).is("li"))return WYMeditor.console.log("Correcting orphaned root li before correcting invalid list nesting."),this._correctOrphanedListItem(c),this.correctInvalidListNesting(c,!0);if(!jQuery(c).is("ol,ul"))return WYMeditor.console.error("Can't correct invalid list nesting. No root list found"),
b;return this._correctInvalidListNesting(c,b)};WYMeditor.editor.prototype._correctOrphanedListItem=function(a){var b,c,d=jQuery();b=jQuery(a).prevContentsUntil(":not(li)");c=jQuery(a).nextContentsUntil(":not(li)");d=d.add(b);d=d.add(a);d=d.add(c);a=d[0].previousSibling;if(!a||!jQuery(a).is("ol,ul"))d.before("<ol></ol>"),a=d.prev()[0];jQuery(a).append(d)};
WYMeditor.editor.prototype._correctInvalidListNesting=function(a,b){var c=a,d=!1,e,f,g;for(typeof b!=="undefined"&&(d=b);c;)if(c._wym_visited){c._wym_visited=!1;if(c===a)break;c=c.previousSibling?c.previousSibling:c.parentNode}else{if(c!==a&&!jQuery(c).is("li"))for(g=c;g.parentNode;){g=g.parentNode;if(jQuery(g).is("li"))break;if(g.nodeType!==WYMeditor.NODE.ELEMENT)break;f=g.tagName.toLowerCase();if(f==="ol"||f==="ul"){WYMeditor.console.log("Fixing orphaned list content");d=!0;f=[c];e=c;for(g=null;e.previousSibling;){e=
e.previousSibling;if(jQuery(e).is("li")){g=e;break}f.push(e)}f.reverse();if(!g&&f.length===1&&jQuery(c.nextSibling).is("li"))g=c.nextSibling;g||(jQuery(f[0]).before('<li class="spacer_li"></li>'),g=jQuery(f[0]).prev()[0]);e=jQuery(g).contents().last();e.length===1&&e[0].nodeType===WYMeditor.NODE.TEXT&&f[0].nodeType===WYMeditor.NODE.TEXT&&jQuery(g).append("<br />");jQuery(g).append(jQuery(f));break}}c.lastChild?(c._wym_visited=!0,c=c.lastChild):c=c.previousSibling?c.previousSibling:c.parentNode}return d};
WYMeditor.editor.prototype.getCommonParentList=function(a,b){var c,d,e=!0;a=jQuery(a).filter("li");if(a.length===0)return null;c=jQuery(a[0]).parents("ol,ul");c=b?c.first():c.last();if(c.length===0)return null;d=c[0];jQuery(a).each(function(a,g){c=jQuery(g).parents("ol,ul");c=b?c.first():c.last();if(c.length===0||c[0]!==d)e=!1});if(!e)return null;return d};
WYMeditor.editor.prototype._getSelectedListItems=function(a){var b,c,d,e=[],f=[],g,h,i;g=function(a){var b;if(rangy.dom.isCharacterDataNode(a))return a;try{b=d.containsNodeText(a)}catch(c){return!0}if(b===!0)return!0};for(b=0;b<a.rangeCount;b++)if(d=a.getRangeAt(b),d.collapsed===!0)(c=this.findUp(d.startContainer,"li"))&&(e=e.concat([c]));else{e=e.concat(d.getNodes([],g));h=[];for(c=0;c<e.length;c++)if(i=e[c],!jQuery(i).is("li,ol,ul"))for(;i.parentNode;)if(i=i.parentNode,jQuery(i).is("li")){h.push(i);
break}for(c=0;c<h.length;c++)jQuery.inArray(h[c],e)===-1&&e.push(h[c])}for(b=0;b<e.length;b++)e[b].nodeType===WYMeditor.NODE.ELEMENT&&e[b].tagName.toLowerCase()===WYMeditor.LI&&f.push(e[b]);return f};WYMeditor.editor.prototype._selectionOnlyInList=function(a){var b=this._wym,c,d,e;for(e=0;e<a.rangeCount;++e){c=b.findUp(a.getRangeAt(e).startContainer,["li"]);d=b.findUp(a.getRangeAt(e).endContainer,["li"]);if(!c||!d)return!1;if(!b.getCommonParentList([c,d],!1))return!1}return!0};
WYMeditor.editor.prototype.indent=function(){var a=this._wym,b=rangy.getIframeSelection(this._iframe),c,d;if(a.restoreSelectionAfterManipulation(function(){var b=a.selected();b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)}))return!0;b=rangy.getIframeSelection(this._iframe);if(!a._selectionOnlyInList(b))return!1;c=a._getSelectedListItems(b);if(c.length===0)return!1;return a.restoreSelectionAfterManipulation(function(){var b=!1;for(d=0;d<c.length;d++)a._indentSingleItem(c[d]),
b=!0;return b})};
WYMeditor.editor.prototype.outdent=function(){var a=this._wym,b=rangy.getIframeSelection(this._iframe),c,d;if(a.restoreSelectionAfterManipulation(function(){var b=a.selected();b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)}))return!0;b=rangy.getIframeSelection(this._iframe);if(!a._selectionOnlyInList(b))return!1;c=a._getSelectedListItems(b);if(c.length===0)return!1;return a.restoreSelectionAfterManipulation(function(){var b=!1;for(d=0;d<c.length;d++)a._outdentSingleItem(c[d]),b=
!0;return b})};WYMeditor.editor.prototype.restoreSelectionAfterManipulation=function(a){var b=rangy.saveSelection(rangy.dom.getIframeWindow(this._iframe)),c=!0;try{(c=a())?rangy.restoreSelection(b):rangy.removeMarkers(b)}catch(d){WYMeditor.console.error("Error during manipulation"),WYMeditor.console.error(d),rangy.removeMarkers(b)}return c};
WYMeditor.editor.prototype.insertOrderedlist=function(){var a=this,b;if(a.restoreSelectionAfterManipulation(function(){var b=a.selected();b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)}))return!0;return a.restoreSelectionAfterManipulation(function(){return a._insertList("ol")})};
WYMeditor.editor.prototype.insertUnorderedlist=function(){var a=this,b;if(a.restoreSelectionAfterManipulation(function(){var b=a.selected();b=a.findUp(b,["ol","ul","li"]);return a.correctInvalidListNesting(b)}))return!0;return a.restoreSelectionAfterManipulation(function(){return a._insertList("ul")})};
WYMeditor.editor.prototype._insertList=function(a){var b=this._wym,c=rangy.getIframeSelection(this._iframe),d=this.selection().getAllRanges();c=b._getSelectedListItems(c);if(c.length!==0)return(d=b.getCommonParentList(c,!0))?(this._changeListType(d,a),!0):!1;jQuery.each(d,function(){this.collapsed&&b._ensureListItem(b.selected(),a);jQuery.each(this.getNodes(),function(){b._ensureListItem(this,a)})});return!1};
WYMeditor.editor.prototype._ensureListItem=function(a,b){var c=this._wym,d=c.findUp(a,WYMeditor.POTENTIAL_LIST_ELEMENTS),e;if(d)return e=jQuery(d),e=e.prev(b).add(e.next(b)),e.length===1?e.append(c._convertToListItem(jQuery(d))):c._convertToList(d,b),!0};WYMeditor.editor.prototype._changeListType=function(a,b){return WYMeditor.changeNodeType(a,b)};
WYMeditor.editor.prototype._convertToListItem=function(a){var b=jQuery([]);a.each(function(){var a=jQuery(this),d=jQuery("<li></li>");d.append(a.html());a.remove();b=b.add(d)});return b};WYMeditor.editor.prototype._convertToList=function(a,b){var c=jQuery(a),d=this._wym,e;e="<"+b+"><li></li></"+b+">";this.findUp(a,WYMeditor.MAIN_CONTAINERS)===a?(e=jQuery(e),e.empty(),c.after(e),e.append(d._convertToListItem(c)),c.remove()):(c.wrapInner(e),e=c.children());return e.get(0)};
WYMeditor.editor.prototype.insertTable=function(a,b,c,d){if(!(a<=0||b<=0)){var e=this._doc.createElement(WYMeditor.TABLE),f=null,g;e.createCaption().innerHTML=c;for(c=0;c<a;c+=1){f=e.insertRow(c);for(g=0;g<b;g+=1)f.insertCell(g)}d!==""&&jQuery(e).attr("summary",d);a=jQuery(this.findUp(this.container(),WYMeditor.POTENTIAL_TABLE_INSERT_ELEMENTS)).get(0);if(!a||!a.parentNode)jQuery(this._doc.body).append(e);else if(jQuery.inArray(a.nodeName.toLowerCase(),WYMeditor.INLINE_TABLE_INSERTION_ELEMENTS)>-1){a=
this.selection().focusNode;if(jQuery.inArray(a.nodeName.toLowerCase(),WYMeditor.SELECTABLE_TABLE_ELEMENTS)>-1||jQuery.inArray(a.parentNode.nodeName.toLowerCase(),WYMeditor.SELECTABLE_TABLE_ELEMENTS)>-1)for(;a.nodeName.toLowerCase()!==WYMeditor.TABLE;)a=a.parentNode;a.nodeName.toLowerCase()===WYMeditor.LI?jQuery(a).append(e):jQuery(a).after(e)}else jQuery(a).after(e);this.afterInsertTable(e);this.fixBodyHtml();return e}};WYMeditor.editor.prototype.afterInsertTable=function(){};
WYMeditor.editor.prototype.listen=function(){var a=this;jQuery(this._doc.body).bind("mouseup keyup change",function(b){a.update_selections.apply(a,[b])});jQuery(a._doc.body).bind("mousedown",function(b){a.mousedown(b)});jQuery(a._doc).bind("paste",function(){a.handlePasteEvent()})};WYMeditor.editor.prototype.handlePasteEvent=function(){var a=this;window.setTimeout(function(){jQuery(a._element).trigger(WYMeditor.EVENTS.postBlockMaybeCreated,a)},20)};
WYMeditor.editor.prototype.mousedown=function(a){this._selectedImage=null;if(a.target.tagName.toLowerCase()===WYMeditor.IMG)this._selectedImage=a.target};
WYMeditor.editor.prototype.update_selections=function(){var a=this;a._box.find(".wym_tools ul > li:not(.wym_tools_html)").removeClass("selected").removeClass("partially_selected");this.selected_parents_contains("b").length&&a._box.find(".wym_tools_strong").addClass("selected");this.selected_parents_contains("i").length&&a._box.find(".wym_tools_emphasis").addClass("selected");this.selected_parents_contains("a").length&&a._box.find(".wym_tools_link, .wym_tools_unlink").addClass("selected");this.selected_parents_contains("li").length&&
a._box.find(".wym_tools_unordered_list").addClass("selected");this.selected_parents_contains("h1").length&&a._box.find(".wym_tools_header").addClass("selected");this.selected_parents_contains("blockquote").length&&a._box.find(".wym_tools_blockquote").addClass("selected");jQuery.each(["b","i","a","li","ul"],function(){a.selected_contains(this).length&&(this==="b"?a._box.find(".wym_tools_strong").addClass("partially_selected"):this==="i"?a._box.find(".wym_tools_emphasis").addClass("partially_selected"):
this==="a"?a._box.find(".wym_tools_link, .wym_tools_unlink").addClass("partially_selected"):this==="li"||this==="ul"?a._box.find(".wym_tools_unordered_list").addClass("partially_selected"):this==="h1"?a._box.find(".wym_tools_header").addClass("partially_selected"):this==="blockquote"&&a._box.find(".wym_tools_blockquote").addClass("partially_selected"))})};
WYMeditor.editor.prototype.initSkin=function(){jQuery(this._box).addClass("wym_skin_"+this._options.skin);typeof WYMeditor.SKINS[this._options.skin]!=="undefined"?typeof WYMeditor.SKINS[this._options.skin].init==="function"&&WYMeditor.SKINS[this._options.skin].init(this):WYMeditor.console.warn("Chosen skin _"+this.options.skin+"_ not found.")};WYMeditor.WymClassSafari=function(a){this._wym=a;this._class="class"};
WYMeditor.WymClassSafari.prototype.initIframe=function(a){this._iframe=a;this._doc=a.contentDocument;this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);this._doc.body.contentEditable="true";this._html(this._wym._options.html);jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery(this._doc).bind("keydown",this.keydown);jQuery(this._doc).bind("keyup",this.keyup);jQuery.isFunction(this._options.postInit)&&this._options.postInit(this);
this.listen();jQuery(this._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)};
WYMeditor.WymClassSafari.prototype._exec=function(a,b){if(!this.selected())return!1;var c,d,e,f;b?this._doc.execCommand(a,"",b):this._doc.execCommand(a,"",null);if(c=this.selected()){d=jQuery(c);e=c.tagName.toLowerCase();if(e===WYMeditor.BODY)f=this.documentStructureManager.structureRules,this._exec(WYMeditor.FORMAT_BLOCK,f.defaultRootContainer),this.fixBodyHtml();a===WYMeditor.FORMAT_BLOCK&&d.siblings("body.wym_iframe").length&&d.siblings("body.wym_iframe").append(c);e==="span"&&(c=!d.attr("class")||
d.attr("class").toLowerCase()==="apple-style-span")&&d.attr("style")==="font-weight: normal;"&&d.contents().unwrap()}return!0};WYMeditor.WymClassSafari.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title];a.ctrlKey?(a.which===WYMeditor.KEY.B&&(b._exec(WYMeditor.BOLD),a.preventDefault()),a.which===WYMeditor.KEY.I&&(b._exec(WYMeditor.ITALIC),a.preventDefault())):a.shiftKey&&a.which===WYMeditor.KEY.ENTER&&(b._exec("InsertLineBreak"),a.preventDefault())};
WYMeditor.WymClassSafari.prototype.keyup=function(a){var b=WYMeditor.INSTANCES[this.title],c,d,e,f,g;e=b.documentStructureManager.structureRules.notValidRootContainers;d=b.documentStructureManager.structureRules.defaultRootContainer;b._selectedImage=null;jQuery.browser.version<534.1&&a.which===WYMeditor.KEY.ENTER&&a.shiftKey&&b._exec("InsertLineBreak");if(!b.keyCanCreateBlockElement(a.which)&&a.which!==WYMeditor.KEY.CTRL&&a.which!==WYMeditor.KEY.COMMAND&&!a.metaKey&&!a.ctrlKey&&(f=(c=b.selected())?
c.tagName.toLowerCase():"body",c&&c.parentNode&&(g=c.parentNode.tagName.toLowerCase()),b.isForbiddenMainContainer(f)&&(f=g),f===WYMeditor.BODY||jQuery.inArray(f,e)>-1&&g===WYMeditor.BODY))b._exec(WYMeditor.FORMAT_BLOCK,d),b.fixBodyHtml();b.keyCanCreateBlockElement(a.which)&&(c=b.selected(),f=c.tagName.toLowerCase(),c.parentNode&&(g=c.parentNode.tagName.toLowerCase()),jQuery.inArray(f,e)>-1&&g===WYMeditor.BODY&&b._exec(WYMeditor.FORMAT_BLOCK,d),b.fixBodyHtml());jQuery(b._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,
[b,jQuery(b._doc.body).html()])};WYMeditor.WymClassMozilla=function(a){this._wym=a;this._class="class"};WYMeditor.WymClassMozilla.CELL_PLACEHOLDER='<br _moz_dirty="" />';WYMeditor.WymClassMozilla.NEEDS_CELL_FIX=parseInt(jQuery.browser.version,10)===1&&jQuery.browser.version>="1.9.1"&&jQuery.browser.version<"2.0";
WYMeditor.WymClassMozilla.prototype.initIframe=function(a){var b=this;this._iframe=a;this._doc=a.contentDocument;this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);this._html(this._wym._options.html);this.enableDesignMode();jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery(this._doc).bind("keydown",this.keydown);jQuery(this._doc).bind("keyup",this.keyup);jQuery(this._doc).bind("click",this.click);jQuery(this._doc).bind("focus",
function(){b.enableDesignMode.call(b)});jQuery.isFunction(this._options.postInit)&&this._options.postInit(this);this.listen();jQuery(b._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)};
WYMeditor.WymClassMozilla.prototype._html=function(a){if(typeof a==="string"){try{this._doc.designMode="off"}catch(b){}a=a.replace(/<em(\b[^>]*)>/gi,"<i$1>");a=a.replace(/<\/em>/gi,"</i>");a=a.replace(/<strong(\b[^>]*)>/gi,"<b$1>");a=a.replace(/<\/strong>/gi,"</b>");jQuery(this._doc.body).html(a);this._wym.fixBodyHtml();this.enableDesignMode()}else return jQuery(this._doc.body).html();return!1};
WYMeditor.WymClassMozilla.prototype._exec=function(a,b){if(!this.selected())return!1;b?this._doc.execCommand(a,"",b):this._doc.execCommand(a,"",null);var c=this.selected();c&&c.tagName.toLowerCase()===WYMeditor.BODY&&(this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.fixBodyHtml());return!0};var $lastFocusedP=jQuery([]);
WYMeditor.WymClassMozilla.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title],c=jQuery(b.selection().focusNode).closest("p");c.length&&($lastFocusedP=c);if(a.ctrlKey){if(a.which===66)return b._exec(WYMeditor.BOLD),!1;if(a.which===73)return b._exec(WYMeditor.ITALIC),!1}return!0};
WYMeditor.WymClassMozilla.prototype.keyup=function(a){var b=WYMeditor.INSTANCES[this.title],c,d,e,f,g;e=b.documentStructureManager.structureRules.notValidRootContainers;d=b.documentStructureManager.structureRules.defaultRootContainer;b._selectedImage=null;if(!b.keyCanCreateBlockElement(a.which)&&a.which!==WYMeditor.KEY.CTRL&&a.which!==WYMeditor.KEY.COMMAND&&!a.metaKey&&!a.ctrlKey&&(f=(c=b.selected())?c.tagName.toLowerCase():"body",c.parentNode&&(g=c.parentNode.tagName.toLowerCase()),b.isForbiddenMainContainer(f)&&
(f=g),f===WYMeditor.BODY||jQuery.inArray(f,e)>-1&&g===WYMeditor.BODY))b._exec(WYMeditor.FORMAT_BLOCK,d),b.fixBodyHtml();b.keyCanCreateBlockElement(a.which)&&(c=b.selected(),f=c.tagName.toLowerCase(),c.parentNode&&(g=c.parentNode.tagName.toLowerCase()),jQuery.inArray(f,e)>-1&&g===WYMeditor.BODY&&b._exec(WYMeditor.FORMAT_BLOCK,d),b.fixBodyHtml());jQuery(b._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[b,jQuery(b._doc.body).html()])};
WYMeditor.WymClassMozilla.prototype.click=function(){var a=WYMeditor.INSTANCES[this.title],b=a.selected();WYMeditor.WymClassMozilla.NEEDS_CELL_FIX===!0&&b&&b.tagName.toLowerCase()===WYMeditor.TR&&jQuery(WYMeditor.TD,a._doc.body).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER);b&&b.tagName.toLowerCase()===WYMeditor.BODY&&(b=a._iframe.contentWindow.getSelection(),b.isCollapsed===!0&&a._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))};
WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){this._doc.body.contentEditable="true";this._doc.execCommand("styleWithCSS","",!1);this._doc.execCommand("enableObjectResizing",!1,!1)};WYMeditor.WymClassMozilla.prototype.afterInsertTable=function(a){WYMeditor.WymClassMozilla.NEEDS_CELL_FIX===!0&&jQuery(a).find("td").each(function(a,c){jQuery(c).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER)})};WYMeditor.WymClassExplorer=function(a){this._wym=a;this._class="className"};
WYMeditor.WymClassExplorer.prototype.initIframe=function(a){var b=this,c;this._iframe=a;this._doc=a.contentWindow.document;this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);jQuery(this._doc.body).html(this._wym._options.html);this._doc.body.onfocus=function(){b._doc.body.contentEditable="true";b._doc=a.contentWindow.document};this._doc.onbeforedeactivate=function(){b.saveCaret()};jQuery(this._doc).bind("keyup",b.keyup);c=parseInt(jQuery.browser.version,
10);c>=8&&c<9&&jQuery(this._doc).bind("keydown",function(){b.fixBluescreenOfDeath()});this._doc.onkeyup=function(){b.saveCaret()};this._doc.onclick=function(){b.saveCaret()};jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery.isFunction(this._options.postInit)&&this._options.postInit(this);this.listen();jQuery(b._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym);try{this._doc=a.contentWindow.document}catch(d){}};
(function(a){WYMeditor.WymClassExplorer.prototype.initSkin=function(){jQuery(this._box).find(this._options.containerSelector).attr("unselectable","on");a.call(this)}})(WYMeditor.editor.prototype.initSkin);WYMeditor.WymClassExplorer.prototype._exec=function(a,b){b?this._doc.execCommand(a,!1,b):this._doc.execCommand(a)};WYMeditor.WymClassExplorer.prototype.selected=function(){var a=this._iframe.contentWindow.document.caretPos;if(a&&a.parentElement)return a.parentElement()};
WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()};WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()};WYMeditor.WymClassExplorer.prototype.insert=function(a){var b=this._doc.selection.createRange();if(jQuery(b.parentElement()).parents().is(this._options.iframeBodySelector))try{b.pasteHTML(a)}catch(c){}else this.paste(a)};
WYMeditor.WymClassExplorer.prototype.wrap=function(a,b){var c=this._doc.selection.createRange();if(jQuery(c.parentElement()).parents().is(this._options.iframeBodySelector))try{c.pasteHTML(a+c.text+b)}catch(d){}};WYMeditor.WymClassExplorer.prototype.wrapWithContainer=function(a,b){var c=this._wym,d,e;d=jQuery(a).wrap("<"+b+" />");e=rangy.getIframeSelection(c._iframe);c=rangy.createRange(c._doc);c.selectNodeContents(d[0]);c.collapse();e.setSingleRange(c)};
WYMeditor.WymClassExplorer.prototype.unwrap=function(){var a=this._doc.selection.createRange(),b;if(jQuery(a.parentElement()).parents().is(this._options.iframeBodySelector))try{b=a.text,this._exec("Cut"),a.pasteHTML(b)}catch(c){}};
WYMeditor.WymClassExplorer.prototype.keyup=function(a){var b=WYMeditor.INSTANCES[this.title],c,d,e,f,g,h=!1,i;e=b.documentStructureManager.structureRules.notValidRootContainers;d=b.documentStructureManager.structureRules.defaultRootContainer;this._selectedImage=null;if(!b.keyCanCreateBlockElement(a.which)&&a.which!==WYMeditor.KEY.CTRL&&a.which!==WYMeditor.KEY.COMMAND&&!a.metaKey&&!a.ctrlKey&&(c=b.selected(),i=b.selection().focusNode,c&&c.tagName&&(f=c.tagName.toLowerCase()),c.parentNode&&(g=c.parentNode.tagName.toLowerCase()),
b.isForbiddenMainContainer(f)&&(f=g,h=!0),f===WYMeditor.BODY&&i.nodeName==="#text")){if(h)i=i.parentNode;b.wrapWithContainer(i,d);b.fixBodyHtml()}if((a.keyCode===WYMeditor.KEY.UP||a.keyCode===WYMeditor.KEY.DOWN||a.keyCode===WYMeditor.KEY.BACKSPACE||a.keyCode===WYMeditor.KEY.ENTER)&&jQuery.inArray(f,e)>-1&&g===WYMeditor.BODY)b.switchTo(c,d),b.fixBodyHtml();jQuery(b._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[b,jQuery(b._doc.body).html()])};
WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(a,b){var c=this._doc.selection.createRange();b=b?!0:!1;c.moveToElementText(a);c.collapse(b);c.select();a.focus()};
WYMeditor.WymClassExplorer.prototype.paste=function(a){var b=this.selected(),c="",d;if(b&&b.tagName.toLowerCase()!==WYMeditor.BODY)a=jQuery(b).append(a);else{a=a.split(RegExp(this._newLine+"{2,}","g"));b=0;for(d=a.length;b<d;b++)c+="<p>"+a[b].split(this._newLine).join("<br />")+"</p>";a=jQuery(c,this._doc).appendTo(this._doc.body)}c=a[a.length-1];jQuery("body > br",this._doc).remove();this.setFocusToNode(c)};WYMeditor.WymClassOpera=function(a){this._wym=a;this._class="class";this._newLine="\r\n"};
WYMeditor.WymClassOpera.prototype.initIframe=function(a){this._iframe=a;this._doc=a.contentWindow.document;this._doc.title=this._wym._index;jQuery("html",this._doc).attr("dir",this._options.direction);this._doc.body.contentEditable="true";this._html(this._wym._options.html);jQuery.isFunction(this._options.preBind)&&this._options.preBind(this);this._wym.bindEvents();jQuery(this._doc).bind("keydown",this.keydown);jQuery(this._doc).bind("keyup",this.keyup);jQuery.isFunction(this._options.postInit)&&
this._options.postInit(this);this.listen();jQuery(wym._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)};WYMeditor.WymClassOpera.prototype._exec=function(a,b){b?this._doc.execCommand(a,!1,b):this._doc.execCommand(a)};WYMeditor.WymClassOpera.prototype.selected=function(){var a=this._iframe.contentWindow.getSelection().focusNode;return a?a.nodeName==="#text"?a.parentNode:a:null};
WYMeditor.WymClassOpera.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title],c=b._iframe.contentWindow.getSelection().getRangeAt(0).startContainer;!jQuery(c).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]&&!jQuery(c).parentsOrSelf("li")&&!keyCanCreateBlockElement(a.which)&&b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)};
WYMeditor.WymClassOpera.prototype.keyup=function(){var a=WYMeditor.INSTANCES[this.title];a._selected_image=null;$(a._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[a,$(a._doc.body).html()])};
WYMeditor.editor.prototype.resizable=function(a){var b=jQuery(this._box).find("iframe"),c=jQuery(this._box).find(".wym_iframe");a=jQuery.extend({resize:function(){c.height(b.height())},alsoResize:b,handles:"s,e,se",minHeight:250},a);jQuery.isFunction(jQuery.fn.resizable)?jQuery(this._box).resizable(a):WYMeditor.console.error("Oops, jQuery UI.resizable unavailable.")};
(function(a){function b(a){return parseInt(a,10)||0}function c(a){return!isNaN(parseInt(a,10))}a.widget("ui.resizable",a.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var b,c,f,g,h,i=this,k=this.options;this.element.addClass("ui-resizable");
a.extend(this,{_aspectRatio:!!k.aspectRatio,aspectRatio:k.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:k.helper||k.ghost||k.animate?k.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i))this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),
left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),
this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize();this.handles=k.handles||(!a(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});
if(this.handles.constructor===String){if(this.handles==="all")this.handles="n,e,s,w,se,sw,ne,nw";b=this.handles.split(",");this.handles={};for(c=0;c<b.length;c++)f=a.trim(b[c]),h="ui-resizable-"+f,g=a("<div class='ui-resizable-handle "+h+"'></div>"),g.css({zIndex:k.zIndex}),"se"===f&&g.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[f]=".ui-resizable-"+f,this.element.append(g)}this._renderAxis=function(b){var c,d,e;b=b||this.element;for(c in this.handles)this.handles[c].constructor===
String&&(this.handles[c]=a(this.handles[c],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(d=a(this.handles[c],this.element),e=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),d=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(d,e),this._proportionallyResize()),a(this.handles[c])};this._renderAxis(this.element);this._handles=a(".ui-resizable-handle",this.element).disableSelection();
this._handles.mouseover(function(){if(!i.resizing)this.className&&(g=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),i.axis=g&&g[1]?g[1]:"se"});k.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){k.disabled||(a(this).removeClass("ui-resizable-autohide"),i._handles.show())}).mouseleave(function(){!k.disabled&&!i.resizing&&(a(this).addClass("ui-resizable-autohide"),i._handles.hide())}));this._mouseInit()},_destroy:function(){this._mouseDestroy();
var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper)c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove();this.originalElement.css("resize",this.originalResizeStyle);c(this.originalElement);
return this},_mouseCapture:function(b){var c,f,g=!1;for(c in this.handles)if(f=a(this.handles[c])[0],f===b.target||a.contains(f,b.target))g=!0;return!this.options.disabled&&g},_mouseStart:function(c){var e,f,g;g=this.options;e=this.element.position();var h=this.element;this.resizing=!0;/absolute/.test(h.css("position"))?h.css({position:"absolute",top:h.css("top"),left:h.css("left")}):h.is(".ui-draggable")&&h.css({position:"absolute",top:e.top,left:e.left});this._renderProxy();e=b(this.helper.css("left"));
f=b(this.helper.css("top"));g.containment&&(e+=a(g.containment).scrollLeft()||0,f+=a(g.containment).scrollTop()||0);this.offset=this.helper.offset();this.position={left:e,top:f};this.size=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()};this.originalSize=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()};this.originalPosition={left:e,top:f};this.sizeDiff={width:h.outerWidth()-h.width(),height:h.outerHeight()-
h.height()};this.originalMousePosition={left:c.pageX,top:c.pageY};this.aspectRatio=typeof g.aspectRatio==="number"?g.aspectRatio:this.originalSize.width/this.originalSize.height||1;g=a(".ui-resizable-"+this.axis).css("cursor");a("body").css("cursor",g==="auto"?this.axis+"-resize":g);h.addClass("ui-resizable-resizing");this._propagate("start",c);return!0},_mouseDrag:function(b){var c,f=this.helper,g={};c=this.originalMousePosition;var h=this.position.top,i=this.position.left,k=this.size.width,o=this.size.height,
r=this._change[this.axis];if(!r)return!1;c=r.apply(this,[b,b.pageX-c.left||0,b.pageY-c.top||0]);this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)c=this._updateRatio(c,b);c=this._respectSize(c,b);this._updateCache(c);this._propagate("resize",b);if(this.position.top!==h)g.top=this.position.top+"px";if(this.position.left!==i)g.left=this.position.left+"px";if(this.size.width!==k)g.width=this.size.width+"px";if(this.size.height!==o)g.height=this.size.height+"px";f.css(g);!this._helper&&
this._proportionallyResizeElements.length&&this._proportionallyResize();a.isEmptyObject(g)||this._trigger("resize",b,this.ui());return!1},_mouseStop:function(b){this.resizing=!1;var c,f,g,h=this.options;if(this._helper)c=this._proportionallyResizeElements,c=(f=c.length&&/textarea/i.test(c[0].nodeName))&&a.ui.hasScroll(c[0],"left")?0:this.sizeDiff.height,f=f?0:this.sizeDiff.width,f={width:this.helper.width()-f,height:this.helper.height()-c},c=parseInt(this.element.css("left"),10)+(this.position.left-
this.originalPosition.left)||null,g=parseInt(this.element.css("top"),10)+(this.position.top-this.originalPosition.top)||null,h.animate||this.element.css(a.extend(f,{top:g,left:c})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&!h.animate&&this._proportionallyResize();a("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",b);this._helper&&this.helper.remove();return!1},_updateVirtualBoundaries:function(a){var b,
f,g,h;h=this.options;h={minWidth:c(h.minWidth)?h.minWidth:0,maxWidth:c(h.maxWidth)?h.maxWidth:Infinity,minHeight:c(h.minHeight)?h.minHeight:0,maxHeight:c(h.maxHeight)?h.maxHeight:Infinity};if(this._aspectRatio||a){a=h.minHeight*this.aspectRatio;f=h.minWidth/this.aspectRatio;b=h.maxHeight*this.aspectRatio;g=h.maxWidth/this.aspectRatio;if(a>h.minWidth)h.minWidth=a;if(f>h.minHeight)h.minHeight=f;if(b<h.maxWidth)h.maxWidth=b;if(g<h.maxHeight)h.maxHeight=g}this._vBoundaries=h},_updateCache:function(a){this.offset=
this.helper.offset();if(c(a.left))this.position.left=a.left;if(c(a.top))this.position.top=a.top;if(c(a.height))this.size.height=a.height;if(c(a.width))this.size.width=a.width},_updateRatio:function(a){var b=this.position,f=this.size,g=this.axis;if(c(a.height))a.width=a.height*this.aspectRatio;else if(c(a.width))a.height=a.width/this.aspectRatio;if(g==="sw")a.left=b.left+(f.width-a.width),a.top=null;if(g==="nw")a.top=b.top+(f.height-a.height),a.left=b.left+(f.width-a.width);return a},_respectSize:function(a){var b=
this._vBoundaries,f=this.axis,g=c(a.width)&&b.maxWidth&&b.maxWidth<a.width,h=c(a.height)&&b.maxHeight&&b.maxHeight<a.height,i=c(a.width)&&b.minWidth&&b.minWidth>a.width,k=c(a.height)&&b.minHeight&&b.minHeight>a.height,o=this.originalPosition.left+this.originalSize.width,r=this.position.top+this.size.height,n=/sw|nw|w/.test(f);f=/nw|ne|n/.test(f);if(i)a.width=b.minWidth;if(k)a.height=b.minHeight;if(g)a.width=b.maxWidth;if(h)a.height=b.maxHeight;if(i&&n)a.left=o-b.minWidth;if(g&&n)a.left=o-b.maxWidth;
if(k&&f)a.top=r-b.minHeight;if(h&&f)a.top=r-b.maxHeight;if(!a.width&&!a.height&&!a.left&&a.top)a.top=null;else if(!a.width&&!a.height&&!a.top&&a.left)a.left=null;return a},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var a,b,c,g,h,i=this.helper||this.element;for(a=0;a<this._proportionallyResizeElements.length;a++){h=this._proportionallyResizeElements[a];if(!this.borderDif){this.borderDif=[];c=[h.css("borderTopWidth"),h.css("borderRightWidth"),h.css("borderBottomWidth"),
h.css("borderLeftWidth")];g=[h.css("paddingTop"),h.css("paddingRight"),h.css("paddingBottom"),h.css("paddingLeft")];for(b=0;b<c.length;b++)this.borderDif[b]=(parseInt(c[b],10)||0)+(parseInt(g[b],10)||0)}h.css({height:i.height()-this.borderDif[0]-this.borderDif[2]||0,width:i.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.options;this.elementOffset=this.element.offset();this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-
1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++b.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){return{left:this.originalPosition.left+b,width:this.originalSize.width-b}},n:function(a,b,c){return{top:this.originalPosition.top+c,height:this.originalSize.height-c}},s:function(a,b,c){return{height:this.originalSize.height+
c}},se:function(b,c,f){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,f]))},sw:function(b,c,f){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,f]))},ne:function(b,c,f){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,f]))},nw:function(b,c,f){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,f]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]);
b!=="resize"&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).data("ui-resizable"),f=c.options,g=c._proportionallyResizeElements,h=g.length&&/textarea/i.test(g[0].nodeName),i=h&&a.ui.hasScroll(g[0],"left")?0:c.sizeDiff.height;h=
{width:c.size.width-(h?0:c.sizeDiff.width),height:c.size.height-i};i=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null;var k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(h,k&&i?{top:k,left:i}:{}),{duration:f.animateDuration,easing:f.animateEasing,step:function(){var f={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),
10)};g&&g.length&&a(g[0]).css({width:f.width,height:f.height});c._updateCache(f);c._propagate("resize",b)}})}});a.ui.plugin.add("resizable","containment",{start:function(){var c,e,f,g,h,i=a(this).data("ui-resizable"),k=i.element;f=i.options.containment;if(k=f instanceof a?f.get(0):/parent/.test(f)?k.parent().get(0):f)i.containerElement=a(k),/document/.test(f)||f===document?(i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:a(document),left:0,top:0,width:a(document).width(),
height:a(document).height()||document.body.parentNode.scrollHeight}):(c=a(k),e=[],a(["Top","Right","Left","Bottom"]).each(function(a,f){e[a]=b(c.css("padding"+f))}),i.containerOffset=c.offset(),i.containerPosition=c.position(),i.containerSize={height:c.innerHeight()-e[3],width:c.innerWidth()-e[1]},f=i.containerOffset,g=i.containerSize.height,h=i.containerSize.width,h=a.ui.hasScroll(k,"left")?k.scrollWidth:h,g=a.ui.hasScroll(k)?k.scrollHeight:g,i.parentData={element:k,left:f.left,top:f.top,width:h,
height:g})},resize:function(b){var c,f,g,h,i=a(this).data("ui-resizable");c=i.options;f=i.containerOffset;g=i.position;b=i._aspectRatio||b.shiftKey;h={top:0,left:0};var k=i.containerElement;k[0]!==document&&/static/.test(k.css("position"))&&(h=f);if(g.left<(i._helper?f.left:0)){i.size.width+=i._helper?i.position.left-f.left:i.position.left-h.left;if(b)i.size.height=i.size.width/i.aspectRatio;i.position.left=c.helper?f.left:0}if(g.top<(i._helper?f.top:0)){i.size.height+=i._helper?i.position.top-f.top:
i.position.top;if(b)i.size.width=i.size.height*i.aspectRatio;i.position.top=i._helper?f.top:0}i.offset.left=i.parentData.left+i.position.left;i.offset.top=i.parentData.top+i.position.top;c=Math.abs((i._helper?i.offset.left-h.left:i.offset.left-h.left)+i.sizeDiff.width);f=Math.abs((i._helper?i.offset.top-h.top:i.offset.top-f.top)+i.sizeDiff.height);g=i.containerElement.get(0)===i.element.parent().get(0);h=/relative|absolute/.test(i.containerElement.css("position"));g&&h&&(c-=i.parentData.left);if(c+
i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-c,b))i.size.height=i.size.width/i.aspectRatio;if(f+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-f,b))i.size.width=i.size.height*i.aspectRatio},stop:function(){var b=a(this).data("ui-resizable"),c=b.options,f=b.containerOffset,g=b.containerPosition,h=b.containerElement,i=a(b.helper),k=i.offset(),o=i.outerWidth()-b.sizeDiff.width;i=i.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(h.css("position"))&&
a(this).css({left:k.left-g.left-f.left,width:o,height:i});b._helper&&!c.animate&&/static/.test(h.css("position"))&&a(this).css({left:k.left-g.left-f.left,width:o,height:i})}});a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).data("ui-resizable").options,c=function(b){a(b).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};typeof b.alsoResize===
"object"&&!b.alsoResize.parentNode?b.alsoResize.length?(b.alsoResize=b.alsoResize[0],c(b.alsoResize)):a.each(b.alsoResize,function(a){c(a)}):c(b.alsoResize)},resize:function(b,c){var f=a(this).data("ui-resizable"),g=f.options,h=f.originalSize,i=f.originalPosition,k={height:f.size.height-h.height||0,width:f.size.width-h.width||0,top:f.position.top-i.top||0,left:f.position.left-i.left||0},o=function(b,d){a(b).each(function(){var b=a(this),f=a(this).data("ui-resizable-alsoresize"),g={},h=d&&d.length?
d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(h,function(a,b){var c=(f[b]||0)+(k[b]||0);c&&c>=0&&(g[b]=c||null)});b.css(g)})};typeof g.alsoResize==="object"&&!g.alsoResize.nodeType?a.each(g.alsoResize,function(a,b){o(a,b)}):o(g.alsoResize)},stop:function(){a(this).removeData("resizable-alsoresize")}});a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,f=b.size;b.ghost=b.originalElement.clone();b.ghost.css({opacity:0.25,
display:"block",position:"relative",height:f.height,width:f.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof c.ghost==="string"?c.ghost:"");b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).data("ui-resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).data("ui-resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}});a.ui.plugin.add("resizable","grid",{resize:function(){var b=
a(this).data("ui-resizable"),c=b.options,f=b.size,g=b.originalSize,h=b.originalPosition,i=b.axis,k=typeof c.grid==="number"?[c.grid,c.grid]:c.grid,o=k[0]||1,r=k[1]||1,n=Math.round((f.width-g.width)/o)*o;f=Math.round((f.height-g.height)/r)*r;var m=g.width+n;g=g.height+f;var p=c.maxWidth&&c.maxWidth<m,l=c.maxHeight&&c.maxHeight<g,s=c.minWidth&&c.minWidth>m,u=c.minHeight&&c.minHeight>g;c.grid=k;s&&(m+=o);u&&(g+=r);p&&(m-=o);l&&(g-=r);/^(se|s|e)$/.test(i)?(b.size.width=m,b.size.height=g):/^(ne)$/.test(i)?
(b.size.width=m,b.size.height=g,b.position.top=h.top-f):(/^(sw)$/.test(i)?(b.size.width=m,b.size.height=g):(b.size.width=m,b.size.height=g,b.position.top=h.top-f),b.position.left=h.left-n)}})})(jQuery);
instrument_function(function(){(function(a){var b=a([]),c,d,e='<div class="wym_dialog wym_dialog_link"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_LINK+'" /><div class="row"><label>{URL}</label><input type="text" class="wym_href text" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit button button_blue" type="submit" value="{Insert}" /><a class="wym_cancel">{Cancel}</a></div></fieldset></form></div>',f='<div class="wym_dialog wym_dialog_image"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+
WYMeditor.DIALOG_IMAGE+'" /><div class="row"><label>{URL}</label><input type="text" class="wym_src" value="" size="40" /></div><div class="row"><label>{Alternative_Text}</label><input type="text" class="wym_alt" value="" size="40" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form>',
g='<div class="wym_dialog wym_dialog_table"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_TABLE+'" /><div class="row"><label>{Caption}</label><input type="text" class="wym_caption" value="" size="40" /></div><div class="row"><label>{Summary}</label><input type="text" class="wym_summary" value="" size="40" /></div><div class="row"><label>{Number_Of_Rows}</label><input type="text" class="wym_rows" value="3" size="3" /></div><div class="row"><label>{Number_Of_Cols}</label><input type="text" class="wym_cols" value="2" size="3" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form>',
h='<div class="wym_dialog wym_dialog_paste"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_PASTE+'" /><div class="row"><textarea class="wym_text" rows="10" cols="50"></textarea></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form>';WYMeditor.editor.prototype.dialog=function(i,k,o){var r=k="",n=WYMeditor.Helper;this._options.dialogLinkHtml=
e;this._options.dialogImageHtml=f;this._options.dialogTableHtml=g;this._options.dialogPasteHtml=h;this._options.dialogHtml=WYMeditor.DIALOG_BODY;switch(i){case WYMeditor.DIALOG_LINK:k=this._options.dialogLinkHtml;r="Insert a link";break;case WYMeditor.DIALOG_IMAGE:k=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:k=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:k=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:k=this._options.dialogPreviewHtml;break;default:k=
o}o=this._options.dialogHtml;o=n.replaceAll(o,WYMeditor.BASE_PATH,this._options.basePath);o=n.replaceAll(o,WYMeditor.DIRECTION,this._options.direction);o=n.replaceAll(o,WYMeditor.DIALOG_TITLE,this.encloseString(i));o=n.replaceAll(o,WYMeditor.DIALOG_BODY,k);o=n.replaceAll(o,WYMeditor.INDEX,this._index);o=this.replaceStrings(o);r||(r=i.replace("_"," "));b=a.create_modal_dialog(r,o);c=b.data("modal_dialog");i=this._iframe;d=rangy.saveSelection(i.contentDocument&&i.contentDocument.defaultView?i.contentDocument.defaultView:
i.contentWindow);i=this.selected();c.open();b.find("input:visible:first").focus();WYMeditor.INIT_DIALOG(this._index,i);return c};jQuery.fn.closeDialog=function(){rangy.restoreSelection(d);setTimeout({run:function(){c.close();c.$elem.remove();c=!1}}.run,250)};WYMeditor.INIT_DIALOG=function(b,c){var e=WYMeditor.INSTANCES[b],f=window.document,g=jQuery(e._options.dialogTypeSelector).val(),h=e.uniqueStamp(),p=a([]);g===WYMeditor.DIALOG_LINK&&!a(c).is("a")&&(g=e.selected_contains("a"),g.length&&(c=g[0]));
jQuery.isFunction(e._options.preInitDialog)&&e._options.preInitDialog(e,window);c&&(p=jQuery(c),jQuery(".wym_css_class",f).val(p.attr("class")),jQuery(".wym_rel",f).val(p.attr("rel")),p.attr(WYMeditor.HREF)&&jQuery(e._options.hrefSelector).val(p.attr(WYMeditor.HREF)),jQuery(e._options.srcSelector).val(p.attr(WYMeditor.SRC)),jQuery(e._options.titleSelector).val(p.attr(WYMeditor.TITLE)),jQuery(e._options.altSelector).val(p.attr(WYMeditor.ALT)));jQuery(e._options.cancelSelector,f).click(function(){jQuery().closeDialog()});
jQuery(e._options.dialogLinkSelector+" "+e._options.submitSelector).submit(function(b){b.preventDefault();b=jQuery(e._options.hrefSelector+":visible",this).val();var f,g;b.length>0&&(rangy.restoreSelection(d),c&&c.tagName.toLowerCase()===WYMeditor.A?f=jQuery(c):e.selection_collapsed()?(f=e.selection(),g=f.getRangeAt(0),f=a("<a>"+b+"</a>"),g.insertNode(f[0])):(e._exec(WYMeditor.CREATE_LINK,h),f=jQuery("a[href="+h+"]",e._doc.body)),f.attr(WYMeditor.HREF,b),f.attr("target","_blank"));jQuery().closeDialog()});
e._selected_image&&(jQuery(e._options.dialogImageSelector+" "+e._options.srcSelector).val(jQuery(e._selected_image).attr(WYMeditor.SRC)),jQuery(e._options.dialogImageSelector+" "+e._options.titleSelector).val(jQuery(e._selected_image).attr(WYMeditor.TITLE)),jQuery(e._options.dialogImageSelector+" "+e._options.altSelector).val(jQuery(e._selected_image).attr(WYMeditor.ALT)));jQuery(e._options.dialogImageSelector+" "+e._options.submitSelector).submit(function(b){b.preventDefault();b=jQuery(e._options.srcSelector).val();
var c=a([]);b.length>0&&(e._exec(WYMeditor.INSERT_IMAGE,h),c=jQuery("img[src$="+h+"]",e._doc.body),c.attr(WYMeditor.SRC,b),c.attr(WYMeditor.TITLE,jQuery(e._options.titleSelector).val()),c.attr(WYMeditor.ALT,jQuery(e._options.altSelector).val()));jQuery().closeDialog()});jQuery(e._options.dialogTableSelector+" "+e._options.submitSelector).submit(function(a){a.preventDefault();var b=jQuery(e._options.rowsSelector).val(),c=jQuery(e._options.colsSelector).val(),d,f,g;if(b>0&&c>0){a=e._doc.createElement(WYMeditor.TABLE);
d=jQuery(e._options.captionSelector).val();f=a.createCaption();f.innerHTML=d;for(f=0;f<b;f+=1){d=a.insertRow(f);for(g=0;g<c;g+=1)d.insertCell(g)}jQuery(a).attr("summary",jQuery(e._options.summarySelector).val());b=jQuery(e.findUp(e.container(),WYMeditor.MAIN_CONTAINERS)).get(0);!b||!b.parentNode?jQuery(e._doc.body).append(a):jQuery(b).after(a)}jQuery().closeDialog()});jQuery(e._options.dialogPasteSelector+" "+e._options.submitSelector).submit(function(a){a.preventDefault();a=jQuery(e._options.textSelector).val();
e.paste(a);jQuery().closeDialog()});jQuery.isFunction(e._options.postInitDialog)&&e._options.postInitDialog(e,window)}})(jQuery)})(this);
instrument_function(function(){$(function(){function a(a){var c=this,d=this._iframe,e=rangy.saveSelection(d.contentDocument&&d.contentDocument.defaultView?d.contentDocument.defaultView:d.contentWindow);d={photo:"Add an image",audio:"Add an audio file",asset_video:"Add a video"}[a];var f=$.open_remote_modal_dialog(match_protocol($(c._element).data("asset_upload_url"))+"?type="+a,{ignore_parent:!0,do_not_cache:!0,title:d});$(document).one("modal_dialog:remote_dialog_loaded",function(a){a=$(a.target);
var b=a.find("#new_asset"),d=a.find("input[type=file]"),k=a.find("form.embed"),o=b.find(".progress"),r=b.find("input[type=submit]"),n=r.val(),m=!1;b.find("input[type=submit]");d.ksr_uploader();k.on("submit",function(a){var b=k.find("input#url").val();b&&($.ajax({url:k.attr("action"),type:k.attr("method"),data:{"data[data-href]":b,width:$(c._doc.body).width()-18},dataType:"html",success:function(a){$(a).children().length?(c.insertBlock(a),c.ensure_template_links_open_new_windows(),c.insert_empty_p_if_next_block_is_uneditable()):
growl({error:"Unable to embed."});f.close()},error:function(){growl({error:"Unable to embed."});f.close()}}),a.preventDefault())});b.on("ksr_file_upload:reset",function(){b.parent().removeClass("upload_finished").removeClass("uploading");o.removeClass("finished")});b.on("file_queued",function(){b.parent().addClass("uploading");b.find("input[type=submit]").val("Uploading, please wait...")});b.on("file_added",function(a,c){b.trigger("destroy");b.attr("method","put");b.attr("action",c.update_path);b.parent().addClass("upload_finished");
b.find(".credit_and_caption").length?r.val(n):b.submit()});b.on("submit",function(a){a.preventDefault();m||b.parent().is(".upload_finished")&&(m=$.ajax({type:b.attr("method"),url:b.attr("action"),dataType:"json",data:b.serialize(),success:function(a){var d=b.find("#link").val();a=d?$('<a href="'+d+'">'+a.html+"</a>"):$(a.html);if(f.$parent_modal)f.$parent_modal.show(),f.$parent_modal=$([]);rangy.restoreSelection(e);c.insertBlock(a);rangy.removeMarkers(e);c.insert_empty_p_if_next_block_is_uneditable();
c.ensure_template_links_open_new_windows();f.close();$(c._element).trigger("wymeditor:videos_changed").trigger("wym-documentHTMLUpdated")},complete:function(){m=!1}}))});$(document).one("closed.modal_dialog",function(a){$(a.target).find("form.asset_upload").length&&$(a.target).data("modal_dialog")&&$(a.target).remove()})})}WYMeditor.CUSTOM_COMMANDS.push({name:"AssetVideo",run:function(){a.apply(this,["asset_video"])}});WYMeditor.CUSTOM_COMMANDS.push({name:"AssetAudio",run:function(){a.apply(this,
["audio"])}});WYMeditor.CUSTOM_COMMANDS.push({name:"AssetPhoto",run:function(){a.apply(this,["photo"])}});(function(){var a=[];$(document).on("wym-postIframeInitialization",".editor",function(){var a=$(this),b=a.closest("form"),e=!1;a.trigger("wymeditor:videos_changed");b.is(".edit_post")||b.bind("submit",function(f){!e&&a.is(".videos_encoding")&&(f.preventDefault(),b.removeClass("submitting-non-ajax"),$.modal_confirm(function(){e=!0;a.removeClass("videos_encoding");b.submit();e=!1},{title:"Your video is still encoding",
message:"<p>People will not be able to play your video until it finishes encoding.</p> <p>It could take up to 20 mins depending upon the size of your video. So, you may want to wait until it's ready before saving.</p>"}))})});$(document).on("wymeditor:videos_changed",".editor",function(){var c=$(this),d=$.wymeditors(c.data("wym_index")),e=0;_.each(a,function(a){a.stop()});a=[];$(".processing",d._doc).each(function(){var f=$(this);e+=1;a.push($.pollster(URI(f.data("status_path")).addQuery("width",
$(d._doc.body).width()-18).toString(),function(a){if(a.html)return a=$(a.html),e-=1,f.closest(".template").replaceWith(a),c.trigger("wymeditor:videos_changed"),c.trigger("wymeditor:video_encoded"),!0}))});e>0?c.trigger("wymeditor:assets_processing"):$(".failed_video",d._doc).length?c.trigger("wymeditor:assets_processing_failed"):c.trigger("wymeditor:assets_finished");d._doc.defaultView&&d._doc.defaultView.$&&d._doc.defaultView.$.videos_changed()});$(document).on("wymeditor:assets_processing",".editor",
function(){$(this).addClass("assets_processing")});$(document).on("wymeditor:assets_finished",".editor",function(){$(this).removeClass("assets_processing")});$(document).on("wymeditor:assets_processing_failed",".editor",function(){$(this).removeClass("assets_processing_failed").addClass("videos_failed")});$(document).on("ksr_video:pause_all_videos",function(){_.each(WYMeditor.INSTANCES,function(a){a._doc&&a._doc.defaultView&&a._doc.defaultView.$&&a._doc.defaultView.$(".video-player").trigger("ksr_video:pause")})})})()})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"Blockquote",run:function(){var a=$(this.selected()),b=a.closest("blockquote"),c;b.length?(c=$("<p></p>"),a.is(":first-child")?b.before(c):b.after(c),c.append(a),(b.is(":empty")||!b.find("p:not(:empty)").length)&&b.remove(),this.setFocusToNode(c[0])):this.container("blockquote")}})})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"Code",run:function(a){var b=this,c=a||$([]);a=c.html()||"";var d=c.data("style")||"";a=$.create_modal_dialog("Code it up bro",'<form><input class="style" value="'+d+'"/><textarea class="code">'+_.unescape(a)+'</textarea><input type="submit" /></form>');var e=a.data("modal_dialog");e.open();a.find("form").on("submit",function(a){a.preventDefault();var d=$(this);a=_.escape(d.find("textarea.code").val());d=d.find("input.style").val();
c.length?c.html(a):b.insertBlock('<pre class="template code brush: '+d+'" data-style="'+d+'" contenteditable="false">'+a+"</pre>");e.close()})}});$(".editor").on("wym-postIframeInitialization",function(){var a=$(this),b=$.wymeditors(a.data("wym_index"));$(b._doc).on("click","pre.code",function(){var a=$(this);a.find("ul.field-tools").remove();b.exec("Code",[a])})})})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"Headerify",run:function(){$(this.selected()).is("h1")?this.container("p"):this.container("h1")}})})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"KsrProject",run:function(){var a=this,b=this._iframe,c=rangy.saveSelection(b.contentDocument&&b.contentDocument.defaultView?b.contentDocument.defaultView:b.contentWindow),d=!1,e="",f="video",g=this.dialog("Add a project",!1,'<form class="find_project"><fieldset><label>Project:</label><div class="field search"><span class="ss-icon ss-search z3"></span><span class="ss-icon ss-delete z3"></span><input type="text" class="find-project text z2" name="q" size="40"/><div class="results z1 limited-height"><span class="ss-icon ss-directup"></div></div></fieldset><fieldset><select name="type"><option value="video">video</option><option value="widget">widget</option></select></fieldset><input type="submit" value="Insert" class="button button_blue"/><a class="wym_cancel">Cancel</a></form>'),h=
g.$elem;b=h.find("input.find-project");b.closest(".field").livesearch_selector({url:"/projects/options.js",serialize:b,process_data:function(a){return a+"&video=true&widget=true"},cancel_copy:""});h.on("livesearch:selected",function(a,b){d=b[1];e=b[2]});b.on("livesearch_selector:unselect",function(){d=!1});h.on("submit",function(a){a.preventDefault()});h.one("submit",function(){if(d){f=h.find("form select").val();var b='<div class="template '+f+'" contentEditable="false" data-id="'+d+'">'+e[f]+"</div>";
rangy.restoreSelection(c);rangy.removeMarkers(c);a.insertBlock(b);a.ensure_template_links_open_new_windows();a.insert_empty_p_if_next_block_is_uneditable();g.close()}})}})})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"KsrReward",run:function(){var a=this,b=this._iframe,c=rangy.saveSelection(b.contentDocument&&b.contentDocument.defaultView?b.contentDocument.defaultView:b.contentWindow),d=!1,e=[],f=this.dialog("Add a project reward",!1,'<form class="find_project_reward"><fieldset><label>Project:</label><div class="field search"><span class="ss-icon z3 ss-search"></span><span class="ss-icon z3 ss-delete"></span><input type="text" class="find-project text z2" name="q" size="40"/><div class="results z1 limited-height"><span class="ss-icon ss-directup"></div></div></fieldset><fieldset class="reward" style="display:none;"><label>Reward:</label><select name="reward"></select></fieldset><input type="submit" value="Insert" class="button button_blue"/><a class="wym_cancel">Cancel</a></form>'),g=
f.$elem;b=g.find("input.find-project");var h=g.find("select");b.closest(".field").livesearch_selector({url:"/projects/options.js",serialize:b,process_data:function(a){return a+"&rewards=true"},cancel_copy:""});g.on("livesearch:selected",function(a,b){d=b[1];h.empty();e=[];$.each(b[2].rewards,function(a){e.push(this.html);h.append('<option value="'+a+'">'+this.minimum+"\u2013"+this.reward+"</option>")});h.closest("fieldset").slideDown()});b.on("livesearch_selector:unselect",function(){h.empty();h.closest("fieldset").slideUp();
d=!1});g.on("submit",function(a){a.preventDefault()});g.one("submit",function(){if(d){var b=g.find("form select").val();b=e[b];rangy.restoreSelection(c);rangy.removeMarkers(c);a.insertBlock(b);a.ensure_template_links_open_new_windows();a.insert_empty_p_if_next_block_is_uneditable();f.close()}})}})})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"ReadMore",run:function(){$(this._doc).find("div.read_more").remove();this.insertBlock('<div class="read_more" contentEditable="false"></div>');this.insert_empty_p_if_next_block_is_uneditable()}})})})(this);
instrument_function(function(){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"ToggleUnorderedList",run:function(){var a=this.selected();a=$(a);var b=a.closest("li");b.length?(b=$(this.getCommonParentList(b,!0)),b.after("<p>"+a.text()+"</p>"),a.remove(),b.closest("ul:empty").remove()):this.insertUnorderedlist()}})})})(this);
instrument_function(function(){$(function(){WYMeditor.STRINGS.en={Strong:"B",Emphasis:"i",Superscript:"Superscript",Subscript:"Subscript",Ordered_List:"Ordered List",Unordered_List:"List",Indent:"Indent",Outdent:"Outdent",Undo:"Undo",Redo:"Redo",Link:"Link",Unlink:"Unlink",Image:"Image",Table:"Table",HTML:"HTML",Paragraph:"Paragraph",Heading_1:"Heading 1",Heading_2:"Heading 2",Heading_3:"Heading 3",Heading_4:"Heading 4",Heading_5:"Heading 5",Heading_6:"Heading 6",Header:"H1",Preformatted:"Preformatted",
Blockquote:"Quote",Table_Header:"Table Header",URL:"Link URL",Title:"Title",Relationship:"Relationship",Alternative_Text:"Alternative text",Caption:"Caption",Summary:"Summary",Number_Of_Rows:"Number of rows",Number_Of_Cols:"Number of cols",Submit:"Submit",Insert:"Insert",Cancel:"Cancel",Choose:"Choose",Preview:"Preview",Paste_From_Word:"Paste from Word",Tools:"Tools",Containers:"Containers",Classes:"Classes",Status:"Status",Source_Code:"Source code",Project:"Project",Reward:"Reward",Code:"Code",ReadMore:"Read More",
Asset_Photo:"Image",Asset_Video:"Video",Asset_Audio:"Audio"}})})(this);
instrument_function(function(){$(function(){WYMeditor.SKINS.ksr={};WYMeditor.SKINS.ksr_chromeless={};var a={Bold:{name:"Bold",title:"Strong",css:"wym_tools_strong"},Italic:{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},Superscript:{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},Subscript:{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},InsertOrderedList:{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},ToggleUnorderedList:{name:"ToggleUnorderedList",
title:"Unordered_List",css:"wym_tools_unordered_list",html:'<li><a name="ToggleUnorderedList" href="#" title="List"><span class="ss-icon ss-list"></span></a></li>'},Indent:{name:"Indent",title:"Indent",css:"wym_tools_indent"},Outdent:{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},Undo:{name:"Undo",title:"Undo",css:"wym_tools_undo"},Redo:{name:"Redo",title:"Redo",css:"wym_tools_redo"},CreateLink:{name:"CreateLink",title:"Link",css:"wym_tools_link",html:'<li class="wym_tools_link"><a name="CreateLink" href="#" title="Link"><span class="ss-icon ss-link"></span></a></li>'},
Unlink:{name:"Unlink",title:"Unlink",css:"wym_tools_unlink",html:'<li class="wym_tools_unlink"><a name="Unlink" href="#" title="Unlink"><span class="ss-icon ss-unlink"></span></a></li>'},AssetVideo:{name:"AssetVideo",title:"Asset_Video",css:"wym_tools_asset_video",html:'<li><a name="AssetVideo" href="#" title="Video"><span class="ss-icon ss-video"></span></a></li>'},AssetAudio:{name:"AssetAudio",title:"Asset_Audio",css:"wym_tools_asset_audio",html:'<li><a name="AssetAudio" href="#" title="Audio"><span class="ss-icon ss-music"></span></a></li>'},
AssetPhoto:{name:"AssetPhoto",title:"Asset_Photo",css:"wym_tools_asset_photo",html:'<li><a name="AssetPhoto" href="#" title="Image"><span class="ss-icon ss-picture"></span></a></li>'},InsertImage:{name:"InsertImage",title:"Image",css:"wym_tools_image"},InsertTable:{name:"InsertTable",title:"Table",css:"wym_tools_table"},Paste:{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},ToggleHtml:{name:"ToggleHtml",title:"HTML",css:"wym_tools_html",html:'<li class="wym_tools_html"><a name="ToggleHtml" href="#" title="HTML"><span class="ss-icon ss-navigateleft"></span><span class="ss-icon ss-navigateright"></span></a></li>'},
Preview:{name:"Preview",title:"Preview",css:"wym_tools_preview"},Headerify:{name:"Headerify",title:"Header",css:"wym_tools_header"},Blockquote:{name:"Blockquote",title:"Blockquote",css:"wym_tools_blockquote"},Code:{name:"Code",title:"Code",css:"wym_tools_code"},KsrProject:{name:"KsrProject",title:"Project",css:"wym_tools_project"},KsrReward:{name:"KsrReward",title:"Reward",css:"wym_tools_reward"},ReadMore:{name:"ReadMore",title:"ReadMore",css:"wym_tools_read_more"}},b={skin:"ksr",iframeBasePath:"/wymeditor_iframe/",
logoHtml:"",disable_sanitization:!0,wymPath:" ",boxHtml:'<div class="wym_box"><div class="wym_area_top">'+WYMeditor.TOOLS+'</div><div class="wym_area_left"></div><div class="wym_area_right"></div><div class="wym_area_main">'+WYMeditor.HTML+WYMeditor.IFRAME+'</div><div class="wym_area_bottom"></div></div>',htmlHtml:'<div class="wym_html wym_section"><textarea class="wym_html_val"></textarea></div>',postInit:function(a){var b=$(a._doc.body),c=$(a._element);a.ensure_template_links_open_new_windows=function(){b.find(".template a").attr("target",
"_blank")};b.on("dragover drop",function(a){a.preventDefault();return!1});b.html(a.xhtml());b.find(".template").attr("contentEditable","false");a.ensure_template_links_open_new_windows();a.insert_empty_p_if_next_block_is_uneditable();b.on("mouseenter",".template, .read_more",function(){var b=$('<li class="delete"><a href="#" class="delete template-delete" title="Delete"><span class="ss-icon ss-delete"></span></a></li>'),e=$([]),i=$(this),k=$('<ul class="field-tools"></ul>'),o=i.attr("data-edit_url");
i.find(".field-tools").length||(b.click(function(b){b.preventDefault();i.remove();c.trigger("wym-documentHTMLUpdated",[a,$(a._doc.body).html()])}),o&&(e=$('<li class="edit"><a href="'+o+'" class="edit template-edit" title="Edit"><span class="ss-icon ss-write"></span></a></li>'),e.click(function(b){b.preventDefault();var e=$.open_remote_modal_dialog(o,{title:"Update Image Caption",do_not_cache:!0});e.$elem.on("modal_dialog:remote_dialog_loaded",function(){var b=$(this).find("form"),g=b.find("#link"),
h=i.parent("a");g.val(h.attr("href"));$(this).find("form").on("submit",function(k){k.preventDefault();$.ajax({url:b.attr("action"),data:b.serialize(),type:b.attr("method"),dataType:"json",success:function(b){var k=g.val(),m=!!h.length;b=$(b.html);i.replaceWith(b);i=b;k?m?h.attr("href",k):i.wrap('<a href="'+k+'"></a>'):m&&i.unwrap();c.trigger("wym-documentHTMLUpdated",[a,$(a._doc.body).html()]);e.close()}})})})}),k.append(e)),k.append(b),i.append(k))});b.on("mouseleave",".template, .read_more",function(){$(this).find(".field-tools").remove()})},
updateSelector:"form",updateEvent:"submit",before_sanitize:function(a){return a?(a=$(this._doc.body).clone(),a.find(".template").has("embed, object, iframe").empty(),a.html()):!1},before_update:function(){$(this._doc.body).find(".template").has("embed, object, iframe").empty();$(this._doc.body).find(".field-tools").remove()}},c=$.extend({},b,{skin:"ksr_chromeless",toolsItems:[]});$(".editor:visible").livequery(function(){var d=$(this),e,f=[],g=$.extend({},b);d.data("wym_index")||(d.is(".chromeless")?
d.wymeditor(c):($.each(d.data("tools").split(" "),function(){var b=this.toString();a[b]?f.push(a[b]):$.console.log("Editor - missing tool: "+b)}),$.extend(g,{toolsItems:f}),d.wymeditor(g)),e=$.wymeditors(d.data("wym_index")),d.closest("form").on("ajaxForm:beforeSerialize",function(){e.update()}),d.is(".resizable")&&e.resizable({iframeFix:!0}),d.on("destroy",function(){if($.browser.msie){var a=$("<input></input>");$("body").append(a);a.focus();a.remove()}}))});$.ui.plugin.add("resizable","iframeFix",
{start:function(){var a=$(this).data("resizable"),b=a?a.options:{};a&&$(b.iframeFix===!0?"iframe":b.iframeFix).each(function(){$('<div class="ui-resizable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E3}).css($(this).offset()).appendTo("body")})},stop:function(){$("div.ui-resizable-iframeFix").each(function(){this.parentNode.removeChild(this)})}})})})(this);
instrument_function(function(){$(".editor").on("wym-postIframeInitialization",function(){var a=$.wymeditors($(this).data("wym_index")),b=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/|[a-z0-9.\-]+[.](?:com|org|net))(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))*(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:''.,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]|\b))/gi,c=[13,32,192,219,221,59,188,222];$(a._doc.body).on("keyup paste",function(d){var e=!1,f,g;$.each(c,function(){if(d.keyCode===
parseInt(this,10))return e=!0,!1});if(e||d.type==="paste")f=$(this),g=function(){function c(){return this.nodeType===3}function d(){var b=a._iframe;b=rangy.saveSelection(b.contentDocument&&b.contentDocument.defaultView?b.contentDocument.defaultView:b.contentWindow);for(var c=$(this).text(),f=c.indexOf(e[0]),g;f!==-1;)c[f-1]!=="@"&&(c.split(""),g=c.slice(0,f),c=c.slice(f+e[0].length,c.length),c=g+'<a href="'+e[0]+'">'+e[0]+"</a>"+c),f=c.indexOf(e[0],f+e[0].length*2+15);$(this).replaceWith(c);rangy.restoreSelection(b);
rangy.removeMarkers(b)}for(var e,g=f.html(),r;(e=b.exec(g))!==null;)e[0]=e[0].replace(/&nbsp$/,""),e[0]=$("<div/>").html(e[0]).remove().text(),r=$(a._doc.body).find("p:contains("+e[0]+")"),r=r.contents().filter(c),r.each(d)},d.type==="paste"?setTimeout(g,500):g()})})})(this);
instrument_function(function(){$(".editor").on("wym-postIframeInitialization",function(){var a=$(this),b=$.wymeditors(a.data("wym_index")),c;c=a.closest("fieldset").find(".character-counter");if(c.length)a.on("wym-postIframeInitialization",function(){function d(){var a=b.html();a=$("<div>"+a+"</div>").text();c.text(f-a.length)}var e=$(b._doc),f=parseInt(c.data("maxlength"),10);e.on("keyup paste cut",d);a.on("change",function(){setTimeout(d,100)})})})})(this);
instrument_function(function(){$(".editor").on("wym-postIframeInitialization",function(){function a(){f.remove();e&&(rangy.restoreSelection(e),rangy.removeMarkers(e),e=!1)}function b(){setTimeout(function(){if(f.length){var b=f.val();c.paste(b);a()}},5)}var c=$.wymeditors($(this).data("wym_index")),d=$(c._doc.body),e=!1,f=$([]);d.on("keydown",function(a){if(!$.browser.webkit&&!($.browser.msie||$.browser.mozilla&&$.browser.version>=22)){var b=!1;navigator.appVersion.indexOf("Win")!==-1&&(b="Windows");
navigator.appVersion.indexOf("Mac")!==-1&&(b="Mac");navigator.appVersion.indexOf("X11")!==-1&&(b="UNIX");navigator.appVersion.indexOf("Linux")!==-1&&(b="Linux");if((b==="Mac"?a.metaKey:a.ctrlKey)&&a.keyCode===86||a.shiftKey&&a.keyCode===45)a=c._iframe,e=rangy.saveSelection(a.contentDocument&&a.contentDocument.defaultView?a.contentDocument.defaultView:a.contentWindow),f=$('<textarea class="wym_paste"></textarea>',c._doc),d.append(f),f.css({position:"absolute",top:-10,width:1,height:1,overflow:"hidden"}),
f.focus()}});d.on("paste",function(d){var e=d.originalEvent||d;e.clipboardData&&e.clipboardData.getData?(d.preventDefault(),a(),d=e.clipboardData.getData("text/plain")):(b(),d=void 0);d&&c.paste(d)})});WYMeditor.editor.prototype.paste=function(a){var b="",c,d;a=a.split(RegExp(WYMeditor.NEWLINE+"{2,}","g"));if(a.length>1){c=0;for(d=a.length;c<d;c+=1)b+="<p>"+a[c].split(this._newLine).join("<br />")+"</p>";this.insertBlock(b)}else this.insertText(a[0]);jQuery("body > br",this._doc).remove()}})(this);
